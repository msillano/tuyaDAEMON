[{"id":"66ca1554.e4c85c","type":"subflow","name":"red trigger","info":"Build a REDTRG msg for tuya_bridge device.\n\nREDTRG values are in range 2000-3000 (convention)\n\nNote: it uses dp 102 (for  [Switch MS-104]). \nChange the code if your tuya-bridge device uses a different dp.","category":"","in":[{"x":60,"y":80,"wires":[{"id":"f0932848.b39158"}]}],"out":[{"x":360,"y":80,"wires":[{"id":"f0932848.b39158","port":0}]}],"env":[{"name":"TRGnumber","type":"str","value":"800"}],"color":"#A6BBCF","inputLabels":["any msg"],"outputLabels":["continue"],"icon":"font-awesome/fa-arrow-right"},{"id":"f0932848.b39158","type":"function","z":"66ca1554.e4c85c","name":"send  X TRIGGER","func":"const triggerDP = 7;  // tuya-bridge countdown\n// normal use: no msg.payload.data.dps[triggerDP]\n// ack use:   msg.payload.data.dps[triggerDP] > 800\n if ((msg.payload.data != undefined) && (msg.payload.data.dps != undefined) && (msg.payload.data.dps[triggerDP] < 800))\n    return null;\nvar n = env.get(\"TRGnumber\");\nvar trig = {\n       \"payload\": {\n          \"dps\":triggerDP, \n          \"set\": parseInt(n)       \n          }\n}\n\nreturn trig ;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nflow.set(\"tsstart\", null);\nflow.set(\"pingstat\",{\n      total:1,\n      test: 0,\n      sum:0,\n      min: 100000000000,\n      max:0\n});\n","finalize":"","x":210,"y":80,"wires":[[]]},{"id":"81d3b584.14c888","type":"subflow","name":"do logging","info":"This node simulate data received from a tuya device. I.e. the output must go to \"to logging\" input.\nUsed to build an update message for 'mirror' devices.\n\nUsed to process tuyaTRIGGERS.\n\n- `deviceID`: the 'mirror' device ID or CID\n- `fakeDP`: the data point id. Convention: user defined, equal to related tuyaTRIGGER, number (1000-2000). \n- `value`: the new value. If the value starts with '@', then it is eval()ued: exemple '@msg.payoad.set' => eval('msg.payoad.set'))\n\nnote: The 'mirror' device MUST exist in the `fake` branch of **alldevices**.\n\n","category":"","in":[{"x":120,"y":80,"wires":[{"id":"6d1b2b8f.c5e554"}]}],"out":[{"x":460,"y":80,"wires":[{"id":"6d1b2b8f.c5e554","port":0}]}],"env":[{"name":"deviceID","type":"str","value":""},{"name":"propertyDP","type":"str","value":""},{"name":"value","type":"str","value":""}],"color":"#87A980","icon":"node-red/debug.svg"},{"id":"6d1b2b8f.c5e554","type":"function","z":"81d3b584.14c888","name":"do mirror msg","func":"// local function\n// note: the value param can also be a @variable:\n//e.g. \"@msg.payload.set\" => eval(msg.payload.set) \n\n    // builds a fake OUT message\n    var newMsg = {\n        \"payload\": {\n            \"deviceId\": env.get(\"deviceID\"),\n            \"data\": {\n                \"dps\": {}\n                //          \"dps\":[dpname = value]\n            }\n        }\n    };\n    \n    var xvalue = env.get(\"value\").toString().trim();\n    if (xvalue.startsWith('@')){\n        xvalue = eval(xvalue.substring(1));\n    }\n    var dpname = env.get(\"propertyDP\").toString().trim();\n    if (dpname.startsWith('@')){\n        dpname = eval(dpname.substring(1));\n    }\n  \n    newMsg.payload.data.dps[dpname.toString()] = xvalue;\n    return newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":80,"wires":[[]]},{"id":"89f87d49.41b81","type":"tab","label":"tuyaDAEMOM.system","disabled":false,"info":"From ver. 2.0 '_sistem' is implemented as a 'fake SW device.\n\nsee: https://github.com/msillano/tuyaDAEMON/wiki/custom-device-_system"},{"id":"5ff0742e.cec73c","type":"link in","z":"89f87d49.41b81","name":"conn_ev_IN","links":["edf84736.d76338"],"x":195,"y":240,"wires":[["dcb6b333.2b26a"]],"icon":"node-red/arrow-in.svg"},{"id":"9a64c33b.0742e","type":"function","z":"89f87d49.41b81","name":"WiFi check","func":"\n// ceck  devices  AC and  AC + battery ('UPS'): all unconnected => WiFi down\n// version 1.1 (use of _callJSONMethod)\n// ===================================== do not change\n// --------------- locals\nfunction _callJSONMethod(obj, fname, a, b, c, d) {\n    // see: https://stackoverflow.com/questions/49125059/how-to-pass-parameters-to-an-eval-based-function-injavascript\n    var wrap = s => \"{ return \" + obj[fname] + \" };\" //return the block having function expression\n    var func = new Function(wrap(obj[fname])); // ignore ⚠\n    return func.call(null).call(obj, a, b, c, d); //invoke the function using arguments\n}\n//\nvar CONN = \"_connected\"; //  dps = CONN, same as name, see also sub-flow \"connected\" function\nvar PWIFI = \"_WiFinet\";\nvar PAC = \"_ACpower\";\nvar ULST = \"_WiFiunconnected\";\nvar tuyastatus;\nvar count = 0;\nvar tot = 0;\nvar arraybad = [];\n\nfunction _sendOUT(value, list) {\n    // builds an artificial OUT message\n    var newMsg = {\n        \"payload\": {\n            \"deviceId\": \"_system\",\n            \"data\": {\n                \"dps\": {\n                    [PWIFI]: value,\n                    [ULST]: list\n                }\n            }\n        }\n    };\n    return newMsg;\n}\n\nfunction _checkWIFI(o) {\n    if ((o.power === undefined) || (o.power === 'BAT'))\n        return;\n    var stAcc = (o.name ===  undefined? o.id: o.name);     // real, only name/id\n    if (tuyastatus[stAcc] === undefined) return;\n    var usrCONN = _callJSONMethod(alld, \"__getDpsName\", o, CONN);\n    if (tuyastatus[stAcc][usrCONN] === undefined) return; //  _connected not updated\n// ok\n    tot++;\n    if (tuyastatus[stAcc][usrCONN]) {\n        count++;\n    } else {\n        arraybad.push(stAcc);\n    }\n}\n\n// ---------------- main\n// stuff to access data\nvar alld = global.get(\"alldevices\");\nif (alld === undefined)\n    return null;\ntuyastatus = global.get(\"tuyastatus\");\nif (tuyastatus === undefined)\n    return null;\n// find object dp\nvar oDev =       _callJSONMethod(alld, \"__getODev\", \"_system\", \"fake\");\nvar sysDevName = _callJSONMethod(alld, \"__getDevName\", oDev);\nvar usrWIFI =    _callJSONMethod(alld, \"__getDpsName\", oDev, PWIFI);\nvar usrAC =      _callJSONMethod(alld, \"__getDpsName\", oDev, PAC);\n\nvar oldlist = flow.get(ULST);\nvar oldPWIFI = flow.get(PWIFI);\n\ncount = 0;\ntot = 0;\n\n// testing:\nalld.real.forEach(element => _checkWIFI(element));\n\n// function outputs:\nif (tot < 1) {\n    node.status({\n        fill: \"yellow\",\n        shape: \"dot\",\n        text: \"WiFi devices not found\"\n    });\n    return null;\n}\n\nflow.set(ULST, arraybad);\nflow.set(PWIFI, (count > 0));\n\nvar sendnew = (JSON.stringify(oldlist) !== JSON.stringify(arraybad));\nvar sendPWIFI =((count > 0) !== oldPWIFI);\n\nnode.status({\n    fill: (count == 0 ? \"red\" : \"green\"),\n    shape: \"ring\",\n    text: \"WiFi devices ON: \" + count + \"/\" + tot\n});\n\nvar nmsg = _sendOUT((count > 0), arraybad);\n\nif (!sendPWIFI) {\n    delete nmsg.payload.data.dps[PWIFI];\n}\n\n// return(update, alarm)\nif (sendnew && (tuyastatus[sysDevName] !== undefined) && (tuyastatus[sysDevName][usrWIFI] === (count == 0)))\n\tif (tuyastatus[sysDevName][usrAC])  // alarm only if AC OK\n        return [nmsg, nmsg];\nif (sendnew)\n    return [nmsg, null];\n    \nreturn [null, null];\n","outputs":2,"noerr":0,"initialize":"/// Code added here will be run once\n// whenever the node is deployed.\n// --------------- locals\nfunction _callJSONMethod(obj, fname, a, b, c, d) {\n    // see: https://stackoverflow.com/questions/49125059/how-to-pass-parameters-to-an-eval-based-function-injavascript\n    var wrap = s => \"{ return \" + obj[fname] + \" };\" //return the block having function expression\n        var func = new Function(wrap(obj[fname])); // ignore ⚠\n    return func.call(null).call(obj, a, b, c, d); //invoke the function using arguments\n}\n// ---------------- main\nvar PWIFI = \"_WiFinet\";\nvar ULST = \"_WiFiunconnected\";\n\n// stuff to access data and initialize tuyastatus\nvar alld = global.get(\"alldevices\");\nif (alld === undefined) return null;\n// find object dp\nvar oDev = _callJSONMethod(alld, \"__getODev\", \"_system\", \"fake\");\nvar sysDevName = _callJSONMethod(alld, \"__getDevName\", oDev);\nvar usrWiFi = _callJSONMethod(alld, \"__getDpsName\", oDev, PWIFI);\nvar usrLWiFi = _callJSONMethod(alld, \"__getDpsName\", oDev, ULST);\n//\ntuyastatus = global.get(\"tuyastatus\");\nif (tuyastatus === undefined)\n    tuyastatus = {};\nif (tuyastatus[sysDevName] === undefined)\n    tuyastatus[sysDevName] = {};\n// init\ntuyastatus[sysDevName][usrWiFi] = \"start\";\ntuyastatus[sysDevName][usrLWiFi] = [\"new\"];\n//\nnode.status({\n    fill: \"yellow\",\n    shape: \"dot\",\n    text: \"start\"\n});\nglobal.set(\"tuyastatus\", tuyastatus);\nflow.set(ULST, [\"new\"]);\nflow.set(PWIFI, 'new');\n","finalize":"","x":750,"y":300,"wires":[["cd81b742.e8a268"],["12b49b65.6585c5"]]},{"id":"142bb8a.ab9a247","type":"delay","z":"89f87d49.41b81","name":"","pauseType":"delay","timeout":"400","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":300,"wires":[["9a64c33b.0742e"]]},{"id":"687b57e7.524a28","type":"http request","z":"89f87d49.41b81","name":"Nodered site get","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://nodered.org","tls":"","persist":false,"proxy":"","authType":"","x":540,"y":360,"wires":[["4a1c4dc.2b969b4"]]},{"id":"4a1c4dc.2b969b4","type":"function","z":"89f87d49.41b81","name":"LAN check","func":"// checks WEB page\n// version 1.1 (use of _callJSONMethod)\n// ===================================== do not change\nPLAN = \"_LANnet\";\n//\nfunction _sendOUT(key, value) {\n    // builds a fake OUT message\n    var newMsg = {\n        \"payload\": {\n            \"deviceId\": \"_system\",\n            \"data\": {\n                \"dps\": {\n                    [key]: value\n                }\n            }\n        }\n    };\n    return newMsg;\n}\n\nvar oldlan =flow.get(PLAN);\n// this test must be updated in case of node-red home page change\nvar newlan = (msg.payload.indexOf('is a programming tool for wiring') !== -1);\nif  (oldlan === newlan) return null;\n//\nflow.set(PLAN, newlan);\n//\nif (newlan) {\n    node.status({\n        fill: \"green\",\n        shape: \"ring\",\n        text: \"LAN connected\"\n    });\n    return (_sendOUT(PLAN, true));\n} else {\n    node.status({\n        fill: \"red\",\n        shape: \"ring\",\n        text: \"LAN disconnected\"\n    });\n    return (_sendOUT(PLAN, false));\n}\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n// --------------- locals\nfunction _callJSONMethod(obj, fname, a, b, c, d) {\n    // see: https://stackoverflow.com/questions/49125059/how-to-pass-parameters-to-an-eval-based-function-injavascript\n    var wrap = s => \"{ return \" + obj[fname] + \" };\" //return the block having function expression\n        var func = new Function(wrap(obj[fname])); // ignore ⚠\n    return func.call(null).call(obj, a, b, c, d); //invoke the function using arguments\n}\n\nPLAN = \"_LANnet\";\n// ---------------- main\n// stuff to access data\nvar alld = global.get(\"alldevices\");\nif (alld === undefined) return null;\n// find object dp\nvar oDev = _callJSONMethod(alld, \"__getODev\", \"_system\", \"fake\");\nvar sysDevName = _callJSONMethod(alld, \"__getDevName\", oDev);\nvar usrLAN = _callJSONMethod(alld, \"__getDpsName\", oDev, PLAN);\n// init\ntuyastatus = global.get(\"tuyastatus\");\nif (tuyastatus === undefined)\n    tuyastatus = {};\nif (tuyastatus[sysDevName] === undefined)\n    tuyastatus[sysDevName] = {};\n // default\n tuyastatus[sysDevName][usrLAN] = \"start\";   \n //\nnode.status({\n    fill: \"yellow\",\n    shape: \"dot\",\n    text: \"start\"\n});\nglobal.set(\"tuyastatus\", tuyastatus);\nflow.set(PLAN, \"new\");\n\n","finalize":"","x":750,"y":360,"wires":[["663d9857.7d8de8","cd81b742.e8a268"]]},{"id":"cd81b742.e8a268","type":"link out","z":"89f87d49.41b81","name":"to core.logging","links":["9fe80f7e.f3f7e"],"x":1275,"y":180,"wires":[],"icon":"node-red/arrow-in.svg"},{"id":"6d096148.e5e38","type":"function","z":"89f87d49.41b81","name":"ACpower check","func":"// devices AC powered + no batteries: all off => AC power down\n// version 1.1 (use of _callJSONMethod)\n// ===================================== do not change\nvar CONN = \"_connected\"; //  dps = CONN, see also sub-flow \"connected\" function\nvar PAC = \"_ACpower\"; // can have friendly name\nvar ULST = \"_ACunconnected\";\n//\nvar tuyastatus;\nvar count = 0;\nvar tot = 0;\nvar arraybad = [];\n// --------------- locals\n// local functions:\nfunction _callJSONMethod(obj, fname, a, b, c, d) {\n    // see: https://stackoverflow.com/questions/49125059/how-to-pass-parameters-to-an-eval-based-function-injavascript\n    var wrap = s => \"{ return \" + obj[fname] + \" };\" //return the block having function expression\n    var func = new Function(wrap(obj[fname])); // ignore ⚠\n    return func.call(null).call(obj, a, b, c, d); //invoke the function using arguments\n}\n\nfunction _sendOUT(value, list) {\n    // builds an artificial SET MULTIPLE message\n    var newMsg = {\n        \"payload\": {\n            \"deviceId\": \"_system\",\n            \"data\": {\n                \"dps\": {\n                    [PAC]: value,\n                    [ULST]: list\n                }\n            }\n        }\n    };\n    return newMsg;\n}\n// called for any real device in alldevices\nfunction _checkAC(o) {\n    if ((o.power === undefined) || (o.power !== 'AC'))\n        return;\n    var usrDev = (o.name === undefined) ? o.id : o.name;\n    if (tuyastatus[usrDev] === undefined) return; // not found\n    var usrCONN = _callJSONMethod(alld, \"__getDpsName\", o, CONN);\n    if (tuyastatus[usrDev][usrCONN] === undefined) return; //  _connected not updated\n    // ok, test\n    tot++;\n    if (tuyastatus[usrDev][usrCONN]) {\n        count++;\n    } else {\n        arraybad.push(usrDev);\n    }\n}\n\n\n// ---------------- main\n\n// stuff to access data\nvar alld = global.get(\"alldevices\");\nif (alld === undefined)\n    return null;\ntuyastatus = global.get(\"tuyastatus\");\nif (tuyastatus === undefined)\n    return null;\n// find object dp\nvar oDev =       _callJSONMethod(alld, \"__getODev\", \"_system\", \"fake\");\nvar sysDevName = _callJSONMethod(alld, \"__getDevName\", oDev);\nvar usrPAC =     _callJSONMethod(alld, \"__getDpsName\", oDev, PAC);\n\nvar oldlist = flow.get(ULST);\nvar oldPAC = flow.get(PAC);\ncount = 0;\ntot = 0;\n\n// testing:\nalld.real.forEach(element => _checkAC(element));\nflow.set(ULST, arraybad);\nflow.set(PAC, (count > 0));\n\n// case: no devices - no send\nif (tot < 1) {\n    node.status({\n        fill: \"yellow\",\n        shape: \"dot\",\n        text: \"AC devices not found\"\n    });\n    return null;\n}\n// conditions to send\nvar sendnew =  (JSON.stringify(oldlist) !== JSON.stringify(arraybad));\nvar sendPAC =((count > 0) !== oldPAC);\n\n// set status & msg\nnode.status({\n    fill: (count == 0 ? \"red\" : \"green\"),\n    shape: \"ring\",\n    text: \"AC devices ON: \" + count + \"/\" + tot\n});\nvar nmsg = _sendOUT((count > 0), arraybad);\nif (!sendPAC) {\n    delete nmsg.payload.data.dps[PAC];\n}\n\n// return(update, alarm)\nif ((tuyastatus[sysDevName] != undefined) && sendnew && (tuyastatus[sysDevName][usrPAC] === (count == 0)))\n    return [nmsg, nmsg];\nif (sendnew)\n    return [nmsg, null];\n\nreturn [null, null];\n","outputs":2,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n// --------------- locals\nfunction _callJSONMethod(obj, fname, a, b, c, d) {\n    // see: https://stackoverflow.com/questions/49125059/how-to-pass-parameters-to-an-eval-based-function-injavascript\n    var wrap = s => \"{ return \" + obj[fname] + \" };\" //return the block having function expression\n        var func = new Function(wrap(obj[fname])); // ignore ⚠\n    return func.call(null).call(obj, a, b, c, d); //invoke the function using arguments\n}\n// ---------------- main\nvar PAC = \"_ACpower\"; // can have friendly name\nvar ULST = \"_ACunconnected\";\n// stuff to access data\nvar alld = global.get(\"alldevices\");\nif (alld === undefined)\n    return null;\n// find object dp\nvar oDev = _callJSONMethod(alld, \"__getODev\", \"_system\", \"fake\");\nvar sysDevName = _callJSONMethod(alld, \"__getDevName\", oDev);\nvar usrAC = _callJSONMethod(alld, \"__getDpsName\", oDev, PAC);\nvar usrLAC = _callJSONMethod(alld, \"__getDpsName\", oDev, ULST);\n//\ntuyastatus = global.get(\"tuyastatus\");\nif (tuyastatus === undefined)\n    tuyastatus = {};\nif (tuyastatus[sysDevName] === undefined)\n    tuyastatus[sysDevName] = {};\n// init\ntuyastatus[sysDevName][usrAC] = \"start\";\ntuyastatus[sysDevName][usrLAC] = [\"new\"];\n//\nnode.status({\n    fill: \"yellow\",\n    shape: \"dot\",\n    text: \"start\"\n});\nglobal.set(\"tuyastatus\", tuyastatus);\nflow.set(ULST, [\"new\"]);\nflow.set(PAC, \"new\");","finalize":"","x":760,"y":240,"wires":[["cd81b742.e8a268"],["5ff8c041.2a12a"]]},{"id":"12b49b65.6585c5","type":"link out","z":"89f87d49.41b81","name":"WIFI_ALARM","links":[],"x":1220,"y":300,"wires":[],"l":true,"info":"TRIGGER for custom flows.\n\nFired at any change."},{"id":"5ff8c041.2a12a","type":"link out","z":"89f87d49.41b81","name":"AC_ALARM","links":[],"x":1230,"y":240,"wires":[],"l":true,"info":"TRIGGER for custom flows.\n\nFired at any change."},{"id":"663d9857.7d8de8","type":"link out","z":"89f87d49.41b81","name":"LAN_ALARM","links":[],"x":1230,"y":360,"wires":[],"l":true,"info":"TRIGGER for custom flows.\n\nFired at any change."},{"id":"580c2cc4.3ac424","type":"link in","z":"89f87d49.41b81","name":"from core.fake_cmds","links":["18817677.061b9a"],"x":115,"y":180,"wires":[["bda34507.6839e8"]],"icon":"node-red/arrow-in.svg"},{"id":"bda34507.6839e8","type":"function","z":"89f87d49.41b81","name":"checks all fake cmds, _system cmd selector (1)","func":"// Implementation of GET/SET/SCHEMA  commands \n// for 'abstract' device \"_system\"\n// part 1: use of _getGlobalValue(mx).\n\n// ------------- check for ALL fake cmds, here for convenience\nif (typeof(msg.to) === undefined)\n         node.warn([\"ASSERT fail: in Fake-msg the msg.to (id) must exist.\",msg]) ;   \n\nif (msg.toDev)\n         node.warn([\"ASSERT fail: in Fake-msg the msg.toDev is NOT required.\",msg]) ;   \n         \nif (typeof(msg.infodp) !== \"string\")\n         node.warn([\"ASSERT fail: msg.infodp (string) must exist.\",msg]) ;   \n  \nif (msg.payload.dp)\n         node.warn([\"temporary ASSERT fail: msg.payload.dp (string) is obsolete.\",msg]) ;   \n  \n// --------------- locals\n// implements some watering_sys dp by inheritace + local override\nconst DEVIDSYS = \"_system\";\n\n// fast exit\nif (msg.to !== DEVIDSYS) return([null]);\n\n// --------------- generic stuff\n// test: idDev GET command?\nfunction _isGetCommand(msx) {\n    return ((msx.infodp !== undefined) && (msx.payload.value === undefined));\n}\n\n// test: idDev SET command?\nfunction _isSetCommand(msx) {\n    return ((msx.infodp !== undefined) && (msx.payload.value !== undefined));\n}\n\nfunction _getGlobalValue(mx){\nvar tuyastatus = global.get(\"tuyastatus\");\nif ((tuyastatus !== undefined) && (tuyastatus[mx.payload.device] !== undefined)) { // ok device field\n   if (mx.infodp === \"schema\") \n          return tuyastatus[mx.payload.device];\n   return tuyastatus[mx.payload.device][mx.payload.property];\n   }\nreturn undefined;\n}\n\nfunction _getHome() {\n    let netmap = global.get(\"remotemap\");\n    return (netmap.itself);\n}\n\n// base message to log\nvar newMsg = {\n        \"payload\": {\n            \"deviceId\": \"_system\",\n            \"data\": {\n                \"dps\": {}\n            }\n        }\n    };\n    \nif (_isGetCommand(msg)) {  // a GET\n   switch (msg.infodp){\n      case \"_ACpower\":\n      case \"_WiFinet\":\n      case \"_LANnet\":\n      case \"_DBase\":\n      case \"_proxy\":\n      case \"_laststart\":\n      case \"_trgPing\":\n      case \"_timerON\":\n      case \"_timerOFF\":\n      case \"_ACunconnected\":\n      case \"_WiFiunconnected\":\n      case \"_doSCHEMA\":\n      case \"_doUPDATE\":\n      case \"_doBenchmark\":\n      case \"_doTrigger\":\n      case \"_exec\":\n            // GET implemented reading tuyastatus\n            newMsg.payload.data.dps[msg.infodp] = _getGlobalValue(msg);\n            return([null, newMsg]);\n      case \"schema\":\n           // in schema case, _getGlobalValue   returns the dps: {dp:value,...}\n            newMsg.payload.data.dps = _getGlobalValue(msg);           \n            return([null, newMsg]);\n      case \"_name\":\n            newMsg.payload.data.dps[msg.infodp] = _getHome(msg);\n            return([null, newMsg]);\n   }\n}// endif GET\n\nif (_isSetCommand(msg)) {  // a SET\n// here only _proxy\n    switch (msg.infodp){\n      case \"_proxy\":\n          // set  the http REST request\n            let urls = global.get(\"remotemap\");\n            var out = {\n                   url: null,\n                   headers: null,\n                   payload : msg.payload.value, \n                   };\n               out.payload[\"remote_from\"] =  urls.itself;     \n               let tor  = msg.payload.value.remote;\n               if (tor ===  urls.itself){\n                    out.url = urls.local[tor]+\"/tuyaDAEMON\";\n                } else {\n                    out.url = urls.remote[tor]+\"/tuyaDAEMON\";\n                }\n                if(out.url === \"undefined/tuyaDAEMON\"){\n                   node.warn([\"ERROR [_system]: server \"+tor+\" not found: \", urls]);\n                   return ([null]);\n            }\n// only value JSON            \n            let jv = JSON.stringify(out.payload.value);\n            out.payload.value = jv;\n            delete out.payload.remote;\n            return([out]);\n   }\n} // endif SET\n// not found: no error.  goto next selector\nreturn([null, null, msg]);\n","outputs":3,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nvar zerobnch = {\n    \"device\":\"_system\",\n    \"property\":\"_zeroTask\",\n     }\n    \nflow.set(\"benchmark\", zerobnch);\nflow.set(\"bnch_status\", \"wait\")\n \n// [\"_doSCHEMA\",\"_doUPDATE\",\"_ACpower\",\"_ACunconnected\",\"_benchmark\",\"_benchmark_end\",\"_DBase\",\"_doBenchmark\",\"_LANnet\",\"_laststart\",\"_name\",\"_proxy\",\"_sqlBDlocal\",\"_sqlDBandroid\",\"_timerList\",\"_trgPing\",\"_WiFinet\",\"_WiFiunconnected\",\"_zeroLog\",\"_zeroTask\"]\n// --------------- locals\nfunction _callJSONMethod(obj, fname, a, b, c, d) {\n    var wrap = s => \"{ return \" + obj[fname] + \" };\" //return the block having function expression\n    var func = new Function(wrap(obj[fname]));       // ignore ⚠\n    return func.call(null).call(obj, a, b, c, d);    //invoke the function using arguments\n}\n\n// ---------------- main\nvar SYS = \"_system\"; // can have friendly name\n// stuff to access data\nvar alld = global.get(\"alldevices\");\nif (alld === undefined)\n    return null;\n// find object dp\nvar oDev = _callJSONMethod(alld, \"__getODev\", SYS, \"fake\");\nvar pmDevName = _callJSONMethod(alld, \"__getDevName\", oDev);\n//\ntuyastatus = global.get(\"tuyastatus\");\nif (tuyastatus === undefined)\n    tuyastatus = {};\nif (tuyastatus[pmDevName] === undefined)\n    tuyastatus[pmDevName] = {};\n// init\ntuyastatus[pmDevName][\"_connected\"] = true;\n// intit all GETable dps\n// from _system/doSCHEMA response\nlet dps = [\"_doSCHEMA\",\"_doUPDATE\",\"_ACpower\",\"_ACunconnected\",\"_benchmark\",\"_benchmark_end\",\"_DBase\",\"_doBenchmark\",\"_LANnet\",\"_laststart\",\"_name\",\"_proxy\",\"_sqlBDlocal\",\"_sqlDBandroid\",\"_timerList\",\"_trgPing\",\"_WiFinet\",\"_WiFiunconnected\",\"_zeroLog\",\"_zeroTask\"]\ndps.forEach((dp) => { tuyastatus[pmDevName][dp] = \"none\"; } );\nglobal.set(\"tuyastatus\", tuyastatus);\n","finalize":"","x":340,"y":180,"wires":[["94d30962.525188"],["cd81b742.e8a268"],["50ec6aac.a59194"]],"outputLabels":["proxy","AC",""]},{"id":"f8963a3a.79abc8","type":"trigger","z":"89f87d49.41b81","name":"","op1":"","op2":"ok","op1type":"nul","op2type":"str","duration":"2","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":360,"y":360,"wires":[["687b57e7.524a28"]]},{"id":"dcb6b333.2b26a","type":"trigger","z":"89f87d49.41b81","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"1500","extend":true,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":340,"y":240,"wires":[["142bb8a.ab9a247","f8963a3a.79abc8","6d096148.e5e38"]]},{"id":"94d30962.525188","type":"http request","z":"89f87d49.41b81","name":"call remote REST","method":"GET","ret":"txt","paytoqs":"query","url":"","tls":"","persist":false,"proxy":"","authType":"","x":790,"y":140,"wires":[["2d0192cb.9b177e","6586860d.481bb8"]]},{"id":"2d0192cb.9b177e","type":"subflow:81d3b584.14c888","z":"89f87d49.41b81","name":"proxy log","env":[{"name":"deviceID","value":"_system","type":"str"},{"name":"propertyDP","value":"_proxy","type":"str"},{"name":"value","value":"@JSON.parse(msg.payload)","type":"str"}],"x":1000,"y":100,"wires":[["cd81b742.e8a268"]]},{"id":"50aa886b.a0fde8","type":"inject","z":"89f87d49.41b81","name":"auto","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"","payloadType":"date","x":755,"y":420,"wires":[["9f1e4fcd.e8d9c"]],"icon":"node-red/trigger.svg","l":false},{"id":"9f1e4fcd.e8d9c","type":"function","z":"89f87d49.41b81","name":"start timestamp","func":"\n// =======================  main version 1.1\n// local function to iniect in node \"to logging\"\nfunction _sendSys(key,value){\n// builds a fake OUT message \nvar newMsg = { \"payload\":{\n      \"deviceId\": \"_system\",\n      \"data\": {\n         \"dps\":{\n              [key]:value\n          }}}};\nreturn newMsg;  \n}\n\n// returns data.t or now(), formatted for mySQL, never fails\n// datetime format for mySQL: '2020-12-18 20:45:02' using 'sv' for date format + local timezone\nfunction _mySQLdatetime(mx = null) {\n   if ((mx == null) || (mx.payload.data.t === undefined))\n      return (new Date().toLocaleString('sv'));\n   return (new Date(Number(mx.payload.data.t) * 1000).toLocaleString('sv'));\n}\n\nreturn  _sendSys(\"_laststart\", _mySQLdatetime());\n\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n// initializes tuyastatus._system\n function getSysObj(alldevices){\n if  (alldevices === undefined) return(alldevices);\n return   alldevices.fake.find(device => device.id === \"_system\");\n }\n \n function getDevUsrName(odev){\n  if  (odev.name !== undefined) return(odev.name);\n  return (odev.id);   \n }\n\n\nfunction getDpUsrName(dpx, odev){\n  if  ((odev !== undefined) && (Array.isArray(odev.dps))){\n      var dpo = odev.dps.find(dpnt => dpnt.dp === dpx);\n      if ((dpo !== undefined) && (dpo.name !== undefined)) \n         return (dpo.name);\n  }\n  return (dpx);   \n }\n\nvar osys = getSysObj(global.get(\"alldevices\"));\nif (osys === undefined) return;\nvar tuyastatus = global.get(\"tuyastatus\");\nif (tuyastatus == undefined)\n        tuyastatus = {};\nvar sysUsrName = getDevUsrName(osys);\nif (tuyastatus[sysUsrName] == undefined)\n        tuyastatus[sysUsrName] = {};\nvar startUsrName = getDpUsrName(\"_laststart\",osys);\ntuyastatus[sysUsrName][startUsrName] = null ; \nglobal.set(\"tuyastatus\", tuyastatus);\n \n\n","finalize":"","x":1020,"y":420,"wires":[["5a8e972b.19e048","37306de6.0a7f42"]],"info":"A message at the end of initial setup time (on my PC 7-8s). ready."},{"id":"5a8e972b.19e048","type":"link out","z":"89f87d49.41b81","name":"to core.logging","links":["9fe80f7e.f3f7e"],"x":1115,"y":460,"wires":[],"icon":"font-awesome/fa-expand"},{"id":"37306de6.0a7f42","type":"link out","z":"89f87d49.41b81","name":"start_DEAMON","links":["38438695.852b9a","7454f585.417bcc","23901296.83a0ae","99db9a3e.c2c4a8","676a993c.b2a4a8","1b76f6cb.66b489"],"x":1220,"y":420,"wires":[],"l":true},{"id":"46ee1dd3.444b64","type":"link out","z":"89f87d49.41b81","name":"to triggers.tuya_bridge_IN","links":["69321d9a.30b7d4"],"x":1395,"y":540,"wires":[],"icon":"node-red/arrow-in.svg"},{"id":"dddd354b.758718","type":"function","z":"89f87d49.41b81","name":"ACK  process","func":"var delta;\n\n// test on all tuya_bridge messages\n// output:  finish/ reset/more loops\nif  ((msg.payload.tuyatrigger > 699) &&\n     (msg.payload.tuyatrigger < 1000)){\n     // fallback in case of missed  ACK: restart and keep alive\n     flow.set(\"tsstart\", 0);\n     return([null, msg, msg]); \n     }\n\nif(msg.payload.tuyatrigger != 0 ) // not ACK,  nothing to do\n     return([null,null,null]); \n\n// standard 0 ACK,  nothing to do\n    var old = flow.get(\"tsstart\");\n    if (old === 0)  return([null,null,null]);   // not in ping test\n    \n    var back = Date.now();\n    delta = back - old;\n    if ((delta > 2000) || (delta < 20)) { \n// fallback in case of timeout: restart and keep alive\n         flow.set(\"tsstart\", 0);\n         return([null, null, msg]);\n         }\n\n// ok, updates stats\n  var stats = flow.get(\"pingstat\") ; \n //flow.set(\"pingstat\",{\n //     test: 0,\n //     total:0,\n //     min: 100000000000,\n //     max:0\n // set data    \n   stats.sum += delta;\n    if( stats.min > delta)\n         stats.min = delta;\n    if( stats.max < delta)\n         stats.max = delta;\n    stats.test++;  \n    stats.total--;   \n    flow.set(\"pingstat\", stats);\n \n  if (stats.total >0)  {       // more  tests  \n      flow.set(\"tsstart\", 0);\n      return [null, null, msg];\n      }   \n\n// done, does statistics & msg  \n var st = {\n    \"deviceId\":\"_system\",\n    \"data\":{\n       \"dps\":{\n           \"_trgPing\":{\n               \"count\": stats.test,\n               \"avg\": Math.floor(stats.sum/stats.test),\n               \"max\": stats.max,\n               \"min\": stats.min\n           }\n       }\n    }};  \n   msg.payload = st;\n   flow.set(\"tsstart\", 0);\n// sends results  \n   return([msg, null, null]);\n\n","outputs":3,"noerr":0,"initialize":"","finalize":"","x":750,"y":540,"wires":[["83ac5d1.6b830a"],["dd6c0562.0102c8"],["42fe8eba.e6aa7"]],"outputLabels":["log result","reset0","more"]},{"id":"c23760b2.45d3a","type":"link in","z":"89f87d49.41b81","name":"ping_test","links":["6da77dc2.b387a4"],"x":615,"y":560,"wires":[["dddd354b.758718"]],"icon":"font-awesome/fa-expand"},{"id":"42fe8eba.e6aa7","type":"delay","z":"89f87d49.41b81","name":"more: delay 3","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1020,"y":560,"wires":[["b586e45e.3e10e8"]]},{"id":"589ce690.7b0f58","type":"function","z":"89f87d49.41b81","name":"5","func":"\n flow.set(\"tsstart\", 0);\n flow.set(\"pingstat\",{\n      total:node.name,\n      test: 0,\n      sum:0,\n      min: 100000000000,\n      max:0\n});\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n flow.set(\"tsstart\", 0);","finalize":"","x":810,"y":620,"wires":[["b586e45e.3e10e8"]],"info":"Set the node name only to the ping number required for the test"},{"id":"50ec6aac.a59194","type":"function","z":"89f87d49.41b81","name":"_system cmd selector (2)","func":"// selects&executes commands for _system: part 2\n\n// --------------- locals\nconst DEVID = \"_system\";\nconst triggerDP = 7;  // tuya-bridge countdown\n\n// local functions:\nfunction _callJSONMethod(obj, fname, a, b, c, d) {\n    // see: https://stackoverflow.com/questions/49125059/how-to-pass-parameters-to-an-eval-based-function-injavascript\n    var wrap = s => \"{ return \" + obj[fname] + \" };\" //return the block having function expression\n    var func = new Function(wrap(obj[fname])); // ignore the node-red ⚠ warning\n    return func.call(null).call(obj, a, b, c, d); //invoke the function using arguments\n}\n\n// test: _system GET command?\nfunction _isGetCommand(msx) {\n    return ((msx.infodp !== undefined) && (msx.payload.value === undefined));\n}\n\n// test: _system SET command?\nfunction _isSetCommand(msx) {\n    return ((msx.infodp !== undefined) && (msx.payload.value !== undefined));\n}\n       \n// get a device ID array from alldevices.    (alldevices, limit = 'real', 'virtual', 'fake',  null (all))  \nfunction getIdArray(alld, limit = null){\n    var arr =[];\n    if ((limit === null) || (limit === 'real'))\n       alld.real.forEach(dev =>    arr.push(dev.name||dev.cid||dev.id));\n    if ((limit === null) || (limit === 'virtual'))\n       alld.virtual.forEach(dev => arr.push(dev.name||dev.cid||dev.id));\n    if ((limit === null) || (limit === 'fake'))\n       alld.fake.forEach(dev =>    arr.push(dev.name||dev.cid||dev.id));\n    return arr;\n}\n        \n \n\n//base message to log\nvar newMsg = {\n     payload: {\n         deviceId : \"_system\",\n         data : {\n             dps : {}\n        }\n    }\n};\n\n\n// ============================  fast output processing\nvar req = {\n    to: null,\n    payload: {}\n}\n\n// ------------- main\nif (_isGetCommand(msg)) { // a GET\n    switch (msg.infodp) {\n    case \"_timerList\":\n        return ([null, null, null, {topic: \"list\"}]);\n    case \"_tuyastatus\":\n        return ([null, null, null, null, null, null, null, null, null, null, { payload: msg.payload.value}]);\n    case \"_benchmark\":\n        newMsg.payload.data.dps[msg.infodp] = flow.get(\"benchmark\");\n        return ([null, newMsg]);\n    case \"_zeroLog\":\n    case \"_zeroTask\":               // doing nothing\n        newMsg.payload.data.dps[msg.infodp] = \"done GET \" + msg.infodp;\n        return ([null, newMsg]);\n    case \"_benchmark_step\":\n    case \"_benchmark_end\":\n        msg.payload.value  = \"none\"; // transforms  GET to SET, safe because SET() does nothing\n        break;\n    }\n} // end GET\n\nif (_isSetCommand(msg)) { // a SET\n switch (msg.infodp) {\n    case \"_trgPing\":\n        return ([null, null, msg]);\n// timer\n    case \"_timerON\":\n        if (msg.payload.value.id === undefined)\n            msg.payload.value[\"id\"] = msg._msgid;\n        return ([null, null, null, { topic: \"set\", payload: msg.payload.value } ]);\n    case \"_timerOFF\":\n        return ([null, null, null, { topic: \"clear\", payload: { id: msg.payload.value } } ]);\n// direct access\n    case \"_doTrigger\":\n        msg = { \"payload\": {  \"dps\": triggerDP, \"set\": parseInt(msg.payload.value) } };\n        newMsg.payload.data.dps[msg.infodp] = msg.payload.value;\n        return ([msg, newMsg]); // _to tuya_bridge:output 1\n    case \"_toLowIN\":\n        newMsg.payload.data.dps[msg.infodp] = msg.payload.value;\n        return ([null, newMsg, null, null, msg.payload.value]);\n    case \"_toFastIN\":\n        newMsg.payload.data.dps[msg.infodp] = msg.payload.value;\n        return ([null, newMsg, null, null, null, { payload: msg.payload.value }]);\n    case \"_toStdCmd\":\n        newMsg.payload.data.dps[msg.infodp] = msg.payload.value;\n        return ([null, newMsg, null, null, null, null, { payload: msg.payload.value }]);\n    case \"_toShare\":\n        newMsg.payload.data.dps[msg.infodp] = msg.payload.value;\n        return ([null, newMsg, null, null, null, null, null, msg.payload.value]);\n    case \"_toLogging\":\n        return ([null, null, null, null, null, null, null, null, { payload: msg.payload.value } ]);\n    case \"_toWarn\":\n        node.warn(msg.payload.value);\n        return (null);\n    case \"_toDebug\":\n        return ([null, null, null, null, null, null, null, null, null, { payload: msg.payload.value } ]);\n    case \"_beep\":\n        return ([null, null, null, null, null, null, null, null, null, null, null, { payload: global.get(\"beep64\") }]);\n    case \"_play\" :\n        return ([null, null, null, null, null, null, null, null, null, null, null, null, { payload: msg.payload.value }]);\n        \n// global.tuyastus\n    case \"_doSCHEMA\":\n      let alld1 = global.get(\"alldevices\");\n         // becase is used 'fast_cmds', the controls must be done here\n     let o1 = _callJSONMethod(alld1, \"__getODev\", msg.payload.value);\n      let devName = _callJSONMethod(alld1, \"__getDevName\", o1);\n      if ((o1 === undefined)||(o1.dps === undefined)||(o1.dps.count <1) || (o1.capability && o1.capability.includes('NONE'))) {\n               newMsg.payload.data.dps[msg.infodp] = \"Device not READ accessible: \"+ devName;\n               return ([null, newMsg]);\n               }\n       let list1 = [];\n       if((o1.capability === undefined) || o1.capability.includes('SCHEMA')  || o1.capability.includes('ALL')) { // uses SCHEMA\n                 o1.dps.forEach(function(adp){\n                    if ((adp.capability === undefined) || ([\"RW\",\"RO\",\"GW\",\"WW\"].includes(adp.capability)))\n                         list1.push(adp.name || adp.dp.toString());\n                 }); \n                 if (list1.length == 0){\n                       newMsg.payload.data.dps[msg.infodp] = \"WARNING: \"+ devName + \" without READ DPs.\";\n                       return ([null, newMsg]);\n                 }\n                 gmsg ={payload:{'device': devName}} ;\n                 newMsg.payload.data.dps[msg.infodp] = {device: devName, dps_schema: list1};\n                 return ([null, newMsg, null, null, null, gmsg]);\n                 }\n               \n       o1.dps.forEach(function(property) {                               // uses GETs\n           let dpname = property.name || property.dp.toString();\n           if ((property.capability === undefined) || ([\"RW\",\"RO\",\"GW\",\"WW\"].includes(property.capability)) ) {\n                 gmsg ={  payload:{'device': devName,'property': dpname }} ;\n                 node.send([null, null, null, null, null, gmsg]);\n                 list1.push(dpname);\n                 }\n          });\n       if (list1.length == 0){\n                 newMsg.payload.data.dps[msg.infodp] = \"WARNING: \"+ devName + \" without READ DPs.\";\n                 return ([null, newMsg]);\n                 }\n      newMsg.payload.data.dps[msg.infodp] = {device: devName, dps_get: list1};\n      return ([null, newMsg]);\n      \n    case \"_doUPDATE\":\n        let tuyastatus = global.get(\"tuyastatus\");\n        let alld = global.get(\"alldevices\");\n        let allList = getIdArray(alld, msg.payload.value);\n        let list = [];\n        // becase is used 'fast_cmds', the controls must be done here\n        if ((allList === undefined)||(allList.count <1)) {\n               newMsg.payload.data.dps[msg.infodp] = \"WARNING: Not found \" +msg.payload.value+\" devices\";\n               return ([null, newMsg]);\n               }\n        allList.forEach(function(device) {\n            let devO = _callJSONMethod(alld, \"__getODev\", device);\n            var cnx  = _callJSONMethod(alld, \"__getConnectName\", devO);\n            let devconnected = ((tuyastatus[cnx]) && tuyastatus[cnx]._connected);\n            if (devconnected) {\n                gmsg ={  payload:{'device': '_system','property': '_doSCHEMA', 'value': device }} ;\n                node.send([null, null, null, null, null,gmsg]);\n                list.push(device + '; ok');\n                } else {\n                    if (tuyastatus[device])\n                       list.push(device + '; NOT connected');\n                    else\n                       list.push(device + '; *** NOT FOUND in tuyastatus');\n                }\n            });\n        newMsg.payload.data.dps[msg.infodp] = {[(msg.payload.value ? msg.payload.value + \"_devices\":\"devices\")]:list};\n        return ([null, newMsg]);\n\n    case \"_tuyastatus\":\n        return ([null, null, null, null, null, null, null, null, null, null, {\n                    payload: msg.payload.value,\n                    sysname: msg.payload.device,\n                    propname: msg.payload.property } ]);  // to use the usr-names on answer\n// benchmark\n    case \"_zeroTask\":        //  a return msg is required to process 'share'\n        newMsg.payload.data.dps[msg.infodp] = \"done SET _zeroTask\";\n        return ([null, newMsg]);\n    case \"_zeroLog\":         //  analyzes the given 'value' for tests   \n       newMsg.payload.data.dps[msg.infodp] = \"SET value [\" + typeof(msg.payload.value)+\"]: \" + msg.payload.value ;\n       return ([null, newMsg]); \n    case \"_benchmark\":\n        flow.set(\"benchmark\", msg.payload.value);\n        newMsg.payload.data.dps[msg.infodp] = msg.payload.value;\n        return ([null, newMsg]);\n    case \"_doBenchmark\":\n        benchmark = flow.get(\"benchmark\");\n         //\n        flow.set(\"benchmark_count\", 1);\n        flow.set(\"bnch_status\", \"run\")\n        //  timer for end benckmark\n        var timex = {\n            \"device\": \"_system\",\n            \"property\": \"_timerON\",\n            \"value\": {\n                \"id\": \"bench\",\n                \"timeout\": benchmark.timeout || 10000,\n                \"alarmPayload\":{\n                    \"share\": [{\n                            \"action\": [{\n                                    \"device\": \"_system\",\n                                    \"property\": \"_benchmark_end\"\n                            }] }]\n                }\n            }\n        }\n        return([null, null, null, null, null, {payload:benchmark}, {payload: timex}]);\n     case \"_benchmark_step\":\n        let bnch_status = flow.get(\"bnch_status\");\n        let c = flow.get(\"benchmark_count\");\n// security exit\n        if (c > 9998){\n              flow.set(\"bnch_status\", \"done\");\n              bnch_status = \"done\";\n         }\n        let benchx = flow.get(\"benchmark\");\n        switch (bnch_status){\n            case(\"run\"):\n               flow.set(\"benchmark_count\", c +1);\n               return ([null, null, null, null, null, {payload: benchx}]);        \n            case(\"done\"):\n                flow.set(\"bnch_status\", \"wait\")\n                newMsg.payload.data.dps[\"_doBenchmark\"] = {\n                    \"count\": c,\n                    \"timeout\": benchmark.timeout || 10000,\n                    \"device\": benchmark.device,\n                    \"property\": benchmark.property };\n                return ([null, newMsg]);\n        }\n        return ([null]);\n     case \"_benchmark_end\":\n       flow.set(\"bnch_status\", \"done\");\n       return([null]);\n    case \"_exec\":\n       return ([null, null, null, null, null, null, null, null, null, null, null, null, null, { payload: msg.payload.value } ]);\n} // end case\n} // endif SET\n// not found: no error.  goto next selector\nreturn ([null, null, null, null, null, null, null, null, null, null, null, null, null, null, msg]);\n","outputs":15,"noerr":0,"initialize":"","finalize":"","x":270,"y":660,"wires":[["1f591255.909d6e","808817eb.3be488"],["83ac5d1.6b830a"],["4a94fec5.a7fe7","3d6f6e6b.025d52"],["886cdd12.7efdd"],["3a1df4f8.435cec"],["e8f89f67.1aa7f"],["a838f77b.9166c8"],["e6e5a7b3.a53aa8"],["aa6116ba.7b69c8"],["eff3642f.49bd28"],["cbbbacd7.70e4"],["7e672c85.ba1aa4"],["92a1f6ed.d388f8"],["52445b44.003e34"],["1ac1311.8bdaecf"]],"outputLabels":["to tuya_bridge","to logging","do trg_ping","do Timer","to low_IN","to fast_IN","to std_IN","to share_IN","to logging_IN","do debug","do tuyastatus","do beep64","do play","to_next",""],"info":"Select GET/SET/SCHEMA/MULTIPLE  commands \nfor 'fake' device\n\nImplementation:\n\n\"_system\":\"_trgPing\" accepts only GET: fires a data refresh.\n             \nThe stadard GET tuyaDAEMON request\n````\n    msg.payload:{\n        \"device\":\"_system\", \n        \"property\":\"_trgPing\"  \n        } \n````        \nfires a flow that implements the command.\n"},{"id":"3d6f6e6b.025d52","type":"delay","z":"89f87d49.41b81","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":660,"y":620,"wires":[["589ce690.7b0f58"]]},{"id":"dd6c0562.0102c8","type":"subflow:66ca1554.e4c85c","z":"89f87d49.41b81","name":"reset: trigger0","env":[{"name":"TRGnumber","value":"0","type":"str"}],"x":1220,"y":540,"wires":[["46ee1dd3.444b64"]]},{"id":"83ac5d1.6b830a","type":"link out","z":"89f87d49.41b81","name":"to core.logging","links":["9fe80f7e.f3f7e"],"x":875,"y":480,"wires":[],"icon":"node-red/arrow-in.svg"},{"id":"c050ff26.cacbe","type":"subflow:66ca1554.e4c85c","z":"89f87d49.41b81","name":"ping: trigger1000","env":[{"name":"TRGnumber","value":"1000","type":"str"}],"x":1210,"y":620,"wires":[["46ee1dd3.444b64"]]},{"id":"b586e45e.3e10e8","type":"function","z":"89f87d49.41b81","name":"start time","func":"\nflow.set(\"tsstart\",Date.now());\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":620,"wires":[["c050ff26.cacbe"]]},{"id":"808817eb.3be488","type":"link out","z":"89f87d49.41b81","name":"to trigger.tuya_bridge_IN","links":["69321d9a.30b7d4"],"x":375,"y":480,"wires":[],"icon":"node-red/arrow-in.svg"},{"id":"1f591255.909d6e","type":"subflow:81d3b584.14c888","z":"89f87d49.41b81","name":"","env":[{"name":"deviceID","value":"_system","type":"str"},{"name":"propertyDP","value":"_doTrigger","type":"str"},{"name":"value","value":" @msg.payload.set","type":"str"},{"name":"fakeDP","value":"_trigger","type":"str"}],"x":530,"y":460,"wires":[["83ac5d1.6b830a"]]},{"id":"4a94fec5.a7fe7","type":"subflow:81d3b584.14c888","z":"89f87d49.41b81","name":"","env":[{"name":"deviceID","value":"_system","type":"str"},{"name":"propertyDP","value":"_trgPing","type":"str"},{"name":"value","value":"started","type":"str"},{"name":"fakeDP","value":"_trgPing","type":"str"}],"x":530,"y":500,"wires":[["83ac5d1.6b830a"]]},{"id":"8f549c9f.95925","type":"comment","z":"89f87d49.41b81","name":"_system FAKE DEVICE","info":"**SYSTEM is a fake device** \n\n `_system` is a device handled by tuyaDAEMON, and offerts a centralized information point about tuyaDAEMON and devices status.\n\n**The device _system_ is with fallowing capabilities:**\n\ndefined in _tuyaDAEMON_:\n - **_start**: \"2020-12-31 17:56:01\"|null, _the tuyaDAEMON local start time. For the first 8 seconds it is null, to signal the node-red startup._\n - **_ACpower**: true, _if some AC-powerd devices are connected._\n     false, _if all AC powered device are disconnected_\n - **_WiFinet**: true, _if some WiFi devices (not battery-powered) are connected._\n    false, _if all WiFi device are disconnected_\n - **_LANnet**: true, _if a remote server (http://nodered.org) is reachable_\n    false, _otherwise._\n - **_ACunconnected**: array[x], _List of  AC-powered disconnected devices. When == all, the AC ALARM is send._\n - **_WiFiunconnected**: array[x],  _List of WiFi (AC and UPS) disconnected devices. When == all and ACpower == true the WIFI ALARM is send._\n\ndefined in _tuyaTRIGGER_:\n - **_trgPing**: object { count, avg, max, min}, the tuya cloud trigger timing, Do this test in a quiet moment.\n  \nFor users convenice, `system` also present some LINK:\n - **connection event**  _fired every device status change, logged_\n - **AC ALARM**: _sends a msg every change of ACpower_.\n - **WIFI ALARM**: _sends a msg every change of WiFinet, if ACpower is true._\n - **LAN ALARM**: _sends a msg every change of LANnet_.\n \nIn `global.tuyastatus` we can found, using also tuyaTRIGGER, a `_system` object like this:\n````\n    HAL at home: object\n       start: \"2021-01-08 09:32:08\"\n       _ACpower: true\n       _ACunconnected: array[2]\n           0: \"umidificatore\"\n           1: \"Smart IR 3\"\n       _LANnet: true\n       _WiFinet: true\n       _WiFiunconnected: array[2]\n           0: \"umidificatore\"\n           1: \"Smart IR 3\"\n       _trgPing: object\n           count: 4\n           avg: 213\n           max: 260\n           min: 171\n````    \nAnd for any 'real' device (example):           \n\n````\n    Smart IR 1: object\n      _connected: true\n````\n\nnote:  `'system'` is built as an addon: if your application doesn't need those resources, you can disable/delete all _'system' nodes_. Connection events will no longer be processed.","x":220,"y":120,"wires":[]},{"id":"2483bb6e.de4c14","type":"inject","z":"89f87d49.41b81","name":"GET _ACpower","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_ACpower\"}","payloadType":"json","x":200,"y":1140,"wires":[["aa325e28.91322"]]},{"id":"aa325e28.91322","type":"link out","z":"89f87d49.41b81","name":"to core.std_cmd","links":["8a1da02d.424ae"],"x":435,"y":1100,"wires":[]},{"id":"2e16e8b1.73e438","type":"inject","z":"89f87d49.41b81","name":"GET _name","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_name\"}","payloadType":"json","x":190,"y":1300,"wires":[["aa325e28.91322"]]},{"id":"8ac9a7c7.af5e88","type":"inject","z":"89f87d49.41b81","name":"GET _WiFiunconnected","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_WiFiunconnected\"}","payloadType":"json","x":220,"y":1180,"wires":[["aa325e28.91322"]]},{"id":"d662cee5.a544e","type":"inject","z":"89f87d49.41b81","name":"GET _trgPing","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_trgPing\"}","payloadType":"json","x":190,"y":1260,"wires":[["aa325e28.91322"]]},{"id":"2027330b.fa9a8c","type":"inject","z":"89f87d49.41b81","name":"SET _trgPing","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_trgPing\",\"value\":\"any\"}","payloadType":"json","x":190,"y":1220,"wires":[["aa325e28.91322"]]},{"id":"886cdd12.7efdd","type":"jsontimer","z":"89f87d49.41b81","name":"","locale":"it-IT","localeOptions":"{\"weekday\":\"long\",\"month\":\"2-digit\",\"day\":\"2-digit\"}","x":740,"y":720,"wires":[["f1b6a20b.e720e"],["284250cf.ebbeb"]]},{"id":"f1b6a20b.e720e","type":"switch","z":"89f87d49.41b81","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"list","vt":"str"},{"t":"eq","v":"settimer","vt":"str"},{"t":"eq","v":"error","vt":"str"},{"t":"eq","v":"clearedtimer","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":990,"y":700,"wires":[["47c43848.b113c8"],["71166e6c.2329f"],["152e082b.157508"],["e36be163.d8173"]]},{"id":"818feefe.ab666","type":"link out","z":"89f87d49.41b81","name":"to core.share IN","links":["3d54171f.a9e138"],"x":1235,"y":880,"wires":[]},{"id":"152e082b.157508","type":"subflow:81d3b584.14c888","z":"89f87d49.41b81","name":"","env":[{"name":"deviceID","value":"_system","type":"str"},{"name":"propertyDP","value":"_timerON","type":"str"},{"name":"value","value":"@\"ERROR: \"+msg.error","type":"str"}],"x":1230,"y":760,"wires":[["be8e7d4f.d6577"]]},{"id":"71166e6c.2329f","type":"subflow:81d3b584.14c888","z":"89f87d49.41b81","name":"","env":[{"name":"deviceID","value":"_system","type":"str"},{"name":"propertyDP","value":"_timerON","type":"str"},{"name":"value","value":"@msg.datetime","type":"str"}],"x":1230,"y":720,"wires":[["be8e7d4f.d6577"]]},{"id":"47c43848.b113c8","type":"subflow:81d3b584.14c888","z":"89f87d49.41b81","name":"","env":[{"name":"deviceID","value":"_system","type":"str"},{"name":"propertyDP","value":"_timerList","type":"str"},{"name":"value","value":"@msg.timers","type":"str"}],"x":1230,"y":680,"wires":[["be8e7d4f.d6577"]]},{"id":"be8e7d4f.d6577","type":"link out","z":"89f87d49.41b81","name":"to core.logging","links":["9fe80f7e.f3f7e"],"x":1395,"y":680,"wires":[]},{"id":"2d69ff50.f4e4c","type":"inject","z":"89f87d49.41b81","name":"*timerON 30s ","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_timerON\",\"value\":{\"id\":\"test1\",\"timeout\":30000,\"alarmPayload\":{\"share\":[{\"action\":[{\"device\":\"_system\",\"property\":\"_doTrigger\",\"value\":5000}]}]}}}","payloadType":"json","x":250,"y":1360,"wires":[["7c949bb.9267764"]],"info":"NOTE:\nIt is OK if it sends,  30 s later, a TUYA TRIGGER:  \n  [\"RX: 'HAL@home'/'_doTrigger' \",5000],\nand the TRIGGER5000 produces ( using tuya-cloud automation):\n  [\" RX: 'switch module #1'/'switch'\", \"ON\"] \n  \nFOR test - Required automation in Tuya :\n5000: set  switch module #1 ON:\n\n`if \"tuya_bridge\"countdown:5000, \"tuya_bridge\"countdown:0 + 'switch module #1'switch:on`\n\n"},{"id":"7c949bb.9267764","type":"link out","z":"89f87d49.41b81","name":"to core.std_cmd","links":["8a1da02d.424ae"],"x":455,"y":1360,"wires":[]},{"id":"8abf0fbe.23b36","type":"inject","z":"89f87d49.41b81","name":"timerOFF","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_timerOFF\",\"value\":\"test1\"}","payloadType":"json","x":240,"y":1400,"wires":[["7c949bb.9267764"]]},{"id":"85655caa.46b94","type":"inject","z":"89f87d49.41b81","name":"timer  GET list","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_timerList\"}","payloadType":"json","x":250,"y":1440,"wires":[["7c949bb.9267764"]]},{"id":"e36be163.d8173","type":"subflow:81d3b584.14c888","z":"89f87d49.41b81","name":"","env":[{"name":"deviceID","value":"_system","type":"str"},{"name":"propertyDP","value":"_timerOFF","type":"str"},{"name":"value","value":"@\"Cleared timer id: \"+ msg.id","type":"str"}],"x":1230,"y":800,"wires":[["be8e7d4f.d6577"]]},{"id":"fbc04e05.ea7f6","type":"comment","z":"89f87d49.41b81","name":"Test case for _system","info":"","x":120,"y":1060,"wires":[]},{"id":"851bcf96.8ecb6","type":"link out","z":"89f87d49.41b81","name":"to core.fast_cmds","links":["c084a743.290b28"],"x":975,"y":1120,"wires":[]},{"id":"7ac282a8.cb16dc","type":"inject","z":"89f87d49.41b81","name":"*test TRIGGER 5020","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_doTrigger\",\"value\":5020}","payloadType":"json","x":750,"y":1160,"wires":[["851bcf96.8ecb6"]],"info":"FOR test - Required automations in Tuya :\n\n5020: set  switch module #1 OFF:\n\n`if \"tuya_bridge\"countdown:5020, \"tuya_bridge\"countdown:0 + 'switch module #1'switch:off`"},{"id":"dc9e0d22.63077","type":"inject","z":"89f87d49.41b81","name":"*test TRIGGER 5000","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_doTrigger\",\"value\":5000}","payloadType":"json","x":750,"y":1120,"wires":[["851bcf96.8ecb6"]],"info":"FOR test - Required automations in Tuya :\n5000: set  switch module #1 ON:\n\n`if \"tuya_bridge\"countdown:5000, \"tuya_bridge\"countdown:0 + 'switch module #1'switch:on`\n\n"},{"id":"813245ca.f67af8","type":"comment","z":"89f87d49.41b81","name":"trgPing","info":"","x":990,"y":500,"wires":[]},{"id":"6f547848.10d178","type":"comment","z":"89f87d49.41b81","name":"timer","info":"","x":730,"y":680,"wires":[]},{"id":"21cde6b9.c6121a","type":"comment","z":"89f87d49.41b81","name":"proxy","info":"","x":750,"y":100,"wires":[]},{"id":"50c7d930.c7b2a8","type":"comment","z":"89f87d49.41b81","name":"Alarms","info":"","x":180,"y":320,"wires":[]},{"id":"3a1df4f8.435cec","type":"link out","z":"89f87d49.41b81","name":"to core.low_level_IN","links":["b25c688d.705df8"],"x":535,"y":640,"wires":[]},{"id":"e6e5a7b3.a53aa8","type":"link out","z":"89f87d49.41b81","name":"to core.share IN","links":["3d54171f.a9e138"],"x":535,"y":760,"wires":[]},{"id":"a838f77b.9166c8","type":"link out","z":"89f87d49.41b81","name":"to core.std_cmd","links":["8a1da02d.424ae"],"x":535,"y":720,"wires":[]},{"id":"e8f89f67.1aa7f","type":"link out","z":"89f87d49.41b81","name":"to core.fast_cmds","links":["c084a743.290b28"],"x":535,"y":680,"wires":[]},{"id":"cbbbacd7.70e4","type":"function","z":"89f87d49.41b81","name":"tuyastatus","func":"//  GET, SCHEMA: solved from tuyastaus, returns data \n//  SET, MULTIPLE: added to tuyastatus\n// input: payload:{device:<name>,property:<name>,value} note: names, not id/dp\n\n\n// local functions:\nfunction _callJSONMethod(obj, fname, a, b, c, d) {\n    // see: https://stackoverflow.com/questions/49125059/how-to-pass-parameters-to-an-eval-based-function-injavascript\n    var wrap = s => \"{ return \" + obj[fname] + \" };\" //return the block having function expression\n        var func = new Function(wrap(obj[fname])); // ignore the node-red ⚠ warning\n    return func.call(null).call(obj, a, b, c, d); //invoke the function using arguments\n}\n\nvar tuyastatus = global.get(\"tuyastatus\");\nif (tuyastatus === undefined) return null;\n\n// builds a message for log\nvar newMsg = {\n        \"payload\": {\n            \"deviceId\": \"_system\",\n            \"data\": {\n                \"dps\": {}\n            }\n        }\n    };\n// ----------- is LIST\nif ((msg.payload === undefined) || (msg.payload.device === undefined)){  \n         msg[\"payload\"] = {list: Object.keys(tuyastatus)};\n         newMsg.payload.data.dps[\"_tuyastatus\"] = msg.payload;\n         return (newMsg);\n       }\n\n// -----------------------  device normalization\nvar alld = global.get(\"alldevices\");\nvar devObj = _callJSONMethod(alld, \"__getODev\", msg.payload.device);\nif (devObj === undefined) {\n    node.warn([\"ERROR _system.fastdevice: not found in alldevices the device '\" + msg.payload.device + \"'\", msg]);\n    return [null];\n}\nmsg.payload.device = _callJSONMethod(alld, \"__getDevName\", devObj);\nmsg[\"to\"] = (devObj.cid !== undefined)? devObj.cid: devObj.id;\n// ------------------------ property normalization\nmsg[\"infodp\"] = \"schema\";\nif (msg.payload.property !== undefined)  { \n       dpObj = _callJSONMethod(alld, \"__getODps\", devObj, msg.payload.property);\n       if (dpObj !== undefined) {\n            msg[\"infodp\"] =  dpObj.dp.toString();\n            msg.payload.property = (dpObj.name === undefined) ? dpObj.dp : dpObj.name; \n        } else {\n           msg[\"infodp\"] = msg.payload.property.toString(); \n        }\n}\n//  end normalization\n\n// clear old response, if any\nif (tuyastatus[msg.sysname][msg.propname] !== undefined)\n  delete tuyastatus[msg.sysname][msg.propname];\n\n// ------------ is SCHEMA\nif (msg[\"infodp\"] === \"schema\")  { \n         if ( tuyastatus[msg.payload.device] === undefined) {\n             node.warn([\"Not found in tuyastatus \"+ msg.payload.device], tuyastatus, msg);\n             return null;\n         }\n         msg.payload['value'] =  {schema: tuyastatus[msg.payload.device]};\n         newMsg.payload.data.dps[\"_tuyastatus\"] = msg.payload;\n         return (newMsg);\n}\n// ------------ is GET\nif (msg.payload.value === undefined) { \n        if ( tuyastatus[msg.payload.device] === undefined) {\n             node.warn([\"Not found in tuyastatus \"+ msg.payload.device], tuyastatus, msg);\n             return null;\n         }\n        if ( tuyastatus[msg.payload.device][msg.payload.property] === undefined) {\n             node.warn([\"Not found in tuyastatus \"+ msg.payload.device + \".\"+msg.payload.property], tuyastatus, msg);\n             return null;\n         }\n         msg.payload['value'] = tuyastatus[msg.payload.device][msg.payload.property];\n         newMsg.payload.data.dps[\"_tuyastatus\"] = msg.payload;\n         return (newMsg);\n}\n// ------------ is SET\nif  (tuyastatus[msg.payload.device] !== undefined) {\n         if ( tuyastatus[msg.payload.device] === undefined) {\n             node.warn([\"Not found in tuyastatus \"+ msg.payload.device], tuyastatus, msg);\n             return null;\n         }\n         tuyastatus[msg.payload.device][msg.payload.property] = msg.payload.value;\n         newMsg.payload.data.dps[\"_tuyastatus\"] = msg.payload;\n         global.set(\"tuyastatus\", tuyastatus);\n         return (newMsg);\n}\n//-------------- else ERROR\n    node.warn([\"_system._tuyastatus ERROR\",msg]);\n    return null;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":920,"wires":[["11023367.4cf45d"]]},{"id":"11023367.4cf45d","type":"link out","z":"89f87d49.41b81","name":"to core.logging","links":["9fe80f7e.f3f7e"],"x":895,"y":900,"wires":[]},{"id":"aa6116ba.7b69c8","type":"link out","z":"89f87d49.41b81","name":"to core.logging","links":["9fe80f7e.f3f7e"],"x":535,"y":840,"wires":[]},{"id":"eff3642f.49bd28","type":"debug","z":"89f87d49.41b81","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":535,"y":800,"wires":[],"l":false},{"id":"13f8eb2a.250805","type":"inject","z":"89f87d49.41b81","name":"test toDebug","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_toDebug\",\"value\":\"For test\"}","payloadType":"json","x":770,"y":1200,"wires":[["851bcf96.8ecb6"]]},{"id":"2ce4c555.fb370a","type":"inject","z":"89f87d49.41b81","name":"test toFastIN \"power strip switch1 ON\"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_toFastIN\",\"value\":{\"device\":\"power strip\",\"property\":\"1\",\"value\":\"ON\"}}","payloadType":"json","x":690,"y":1300,"wires":[["851bcf96.8ecb6"]]},{"id":"78de5a90.0bf884","type":"inject","z":"89f87d49.41b81","name":"test toLogging \"system _toWarn Done\"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_toLogging\",\"value\":{\"deviceId\":\"_system\",\"data\":{\"dps\":{\"_toWarn\":\"Done\"}}}}","payloadType":"json","x":690,"y":1340,"wires":[["851bcf96.8ecb6"]]},{"id":"b67d210c.66c28","type":"inject","z":"89f87d49.41b81","name":"test _toStdCmd \"power strip switch1 ON\"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_toStdCmd\",\"value\":{\"device\":\"power strip\",\"property\":\"1\",\"value\":\"ON\"}}","payloadType":"json","x":700,"y":1420,"wires":[["851bcf96.8ecb6"]]},{"id":"4ae227ee.d50958","type":"inject","z":"89f87d49.41b81","name":"test _toLowIN \"power strip switch1 OFF\"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_toLowIN\",\"value\":{\"toDev\":\"3613666124a1600db127\",\"payload\":{\"dps\":\"1\",\"set\":false}}}","payloadType":"json","x":690,"y":1380,"wires":[["851bcf96.8ecb6"]]},{"id":"fc91fdc1.2b279","type":"inject","z":"89f87d49.41b81","name":"test toWarn","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_toWarn\",\"value\":\"OK warn test\"}","payloadType":"json","x":770,"y":1240,"wires":[["851bcf96.8ecb6"]]},{"id":"2c4c87f.8f9c578","type":"inject","z":"89f87d49.41b81","name":"Test tuyastatus LIST","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_tuyastatus\",\"value\":{}}","payloadType":"json","x":210,"y":1520,"wires":[["b4d2d9e.ab5fb28"]]},{"id":"d0f9c712.9691d8","type":"inject","z":"89f87d49.41b81","name":"Test tuyastatus GET \"_laststart\"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_tuyastatus\",\"value\":{\"device\":\"HAL@home\",\"property\":\"_laststart\"}}","payloadType":"json","x":250,"y":1600,"wires":[["b4d2d9e.ab5fb28"]]},{"id":"dce9fb68.20f798","type":"inject","z":"89f87d49.41b81","name":"Test tuyastatus _system.SCHEMA","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_tuyastatus\",\"value\":{\"device\":\"HAL@home\"}}","payloadType":"json","x":260,"y":1560,"wires":[["b4d2d9e.ab5fb28"]]},{"id":"4bdfd324.39f9dc","type":"inject","z":"89f87d49.41b81","name":"Test tuyastatus SET \"_laststart\"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_tuyastatus\",\"value\":{\"device\":\"HAL@home\",\"property\":\"_laststart\",\"value\":\"2000-01-01 15:59:40\"}}","payloadType":"json","x":250,"y":1640,"wires":[["b4d2d9e.ab5fb28"]]},{"id":"602cabcf.0bd114","type":"inject","z":"89f87d49.41b81","name":"GET _system SCHEMA","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\"}","payloadType":"json","x":220,"y":1100,"wires":[["aa325e28.91322"]]},{"id":"6db5220c.6c9b0c","type":"link out","z":"89f87d49.41b81","name":"to core.fast_cmds","links":["c084a743.290b28"],"x":995,"y":1800,"wires":[]},{"id":"bdf69c76.41d49","type":"inject","z":"89f87d49.41b81","name":"test GET last benckmark","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_benchmark\"}","payloadType":"json","x":650,"y":2020,"wires":[["6db5220c.6c9b0c"]]},{"id":"fbffd457.7c0468","type":"inject","z":"89f87d49.41b81","name":"test zeroTASK","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_zeroTask\"}","payloadType":"json","x":630,"y":1800,"wires":[["6db5220c.6c9b0c"]]},{"id":"3ba15d04.5eb9c2","type":"inject","z":"89f87d49.41b81","name":"test zeroLOG","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_zeroLog\",\"value\":\"any\"}","payloadType":"json","x":630,"y":1840,"wires":[["6db5220c.6c9b0c"]]},{"id":"d35496cf.5460c8","type":"inject","z":"89f87d49.41b81","name":"test  SET doBenckmark (START)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_doBenchmark\",\"value\":\"start\"}","payloadType":"json","x":670,"y":2080,"wires":[["6db5220c.6c9b0c"]]},{"id":"15c0e9da.da8da6","type":"inject","z":"89f87d49.41b81","name":"test SET benckmark zeroTask (20s)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_benchmark\",\"value\":{\"device\":\"_system\",\"property\":\"_zeroTask\",\"timeout\":20000}}","payloadType":"json","x":680,"y":1900,"wires":[["6db5220c.6c9b0c"]]},{"id":"ffba941b.5b7c78","type":"inject","z":"89f87d49.41b81","name":"test SET benckmark zeroLog","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_benchmark\",\"value\":{\"device\":\"_system\",\"property\":\"_zeroLog\",\"value\":\"a_string\"}}","payloadType":"json","x":660,"y":1940,"wires":[["6db5220c.6c9b0c"]]},{"id":"aa9acc61.81b7d","type":"inject","z":"89f87d49.41b81","name":"test  GET doBenckmark","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_doBenchmark\"}","payloadType":"json","x":640,"y":2120,"wires":[["6db5220c.6c9b0c"]]},{"id":"87a7bcc7.bedfa","type":"link out","z":"89f87d49.41b81","name":"to core.sql_DB","links":["9538139a.19ca1"],"x":455,"y":920,"wires":[]},{"id":"1ac1311.8bdaecf","type":"function","z":"89f87d49.41b81","name":"*_system custom selector (3)","func":"// selects&executes commands for _system: part 3\n// CUSTOMIZATION for used DB\n//\n// --------------- locals\nconst DEVID = \"_system\";\nconst DBDP =\"_Dbase\";\n\n// local functions:\nfunction _callJSONMethod(obj, fname, a, b, c, d) {\n    // see: https://stackoverflow.com/questions/49125059/how-to-pass-parameters-to-an-eval-based-function-injavascript\n    var wrap = s => \"{ return \" + obj[fname] + \" };\" //return the block having function expression\n        var func = new Function(wrap(obj[fname])); // ignore the node-red ⚠ warning\n    return func.call(null).call(obj, a, b, c, d); //invoke the function using arguments\n}\n\nfunction _getGlobalValue(mx){\nvar tuyastatus = global.get(\"tuyastatus\");\nif ((tuyastatus !== undefined) && (tuyastatus[mx.payload.device] !== undefined)) { // ok device field\n   if (mx.infodp === \"schema\") \n          return tuyastatus[mx.payload.device];\n   return tuyastatus[mx.payload.device][mx.payload.property];\n   }\nreturn undefined;\n}\n\n// test: _system GET command?\nfunction _isGetCommand(msx) {\n    return ((msx.infodp !== undefined) && (msx.payload.value === undefined));\n}\n\n// test: _system SET command?\nfunction _isSetCommand(msx) {\n    return ((msx.infodp !== undefined) && (msx.payload.value !== undefined));\n}\n\n//base message to log\nvar newMsg = {\n     payload: {\n         deviceId : DEVID,\n         data : {\n             dps : {}\n        }\n    }\n};\n// --------------------------  main\nif (_isGetCommand(msg)) { // a GET\n    switch (msg.infodp) {\n      case \"_sqlDBlocal\":     \n      case \"_sqlDBandroid\":            // one 'dp' for DB\n// GET implemented reading tuyastatus\n            newMsg.payload.data.dps[msg.infodp] = _getGlobalValue(msg);\n            return([newMsg]);\n    }\n}\n\nif (_isSetCommand(msg)) { // a SET\n    switch (msg.infodp) {\n      case \"_sqlDBlocal\":\n      case \"_sqlDBandroid\":              // one 'dp' for DB: HERE CUSTOM\n//\n// test: are DBs ok? reading tuyastatus._system. _BBase (for all DBs, true|false)\n// ---- get user name\n    var alld = global.get(\"alldevices\");\n    var devObj = _callJSONMethod(alld, \"__getODev\", DEVID, \"fake\");\n    var dpObj  = _callJSONMethod(alld, \"__getODps\", devObj, \"_DBase\");\n    var devName= devObj.name? devObj.name:\"_system\";\n    var dpName = dpObj.name? dpObj.name: \"_DBase\";\n// test\n   let tuyastatus = global.get(\"tuyastatus\");\n   if ( tuyastatus[devName][dpName])\n       return ( [null,  {topic: msg.payload.value,\n                        to: msg.to,\n                        infodp: msg.infodp }]);  \n    node.warn([\"WARNING: sql not performed: Dbase now not connected.\",msg]);\n    return ([null]);\n     }\n}\n\n// last selector: warning if not processed\nnode.warn([\"WARNING [\"+DEVID+\"] The dp '\"+msg.infodp+\"' is NOT impelemented.\", msg])\nreturn ([null]);\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":280,"y":900,"wires":[["11023367.4cf45d"],["87a7bcc7.bedfa"]],"info":"CUSTOMIZATION\n\nAdding/deleting DB: here is the case of 2 DB \n\nTo add/modify DB\n  \n - set 2 nodes for every DB (log, no-log)\n - update '*all DB status' node\n  \n - define a `_system` property for every DB (like `_sqlDBlocal`, `_sqlDBandroid`) \n \n - add properties to alldevices (using `tuyadaemotoolkit` if you like)\n - edit this function: one 'dp' for DB\n  \n- update the core.'*DB mux-filter' node"},{"id":"373a99c1.1f5906","type":"inject","z":"89f87d49.41b81","name":"test SET benckmark GET tuya_bridge.restart status","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_benchmark\",\"value\":{\"device\":\"tuya_bridge\",\"property\":\"restart status\"}}","payloadType":"json","x":730,"y":1980,"wires":[["6db5220c.6c9b0c"]]},{"id":"197e0cd4.7da683","type":"inject","z":"89f87d49.41b81","name":"test DB local: COUNT(*)","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_sqlDBlocal","vt":"str"},{"p":"payload.value","v":"SELECT COUNT(*) FROM messages","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":230,"y":2100,"wires":[["3332c2d3.f540ae"]]},{"id":"3332c2d3.f540ae","type":"link out","z":"89f87d49.41b81","name":"to core.std_cmd","links":["8a1da02d.424ae"],"x":475,"y":2100,"wires":[]},{"id":"8ca64de0.53053","type":"inject","z":"89f87d49.41b81","name":"test DB android: COUNT(*)","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_sqlDBandroid","vt":"str"},{"p":"payload.value","v":"SELECT COUNT(*) FROM messages","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":230,"y":2140,"wires":[["3332c2d3.f540ae"]]},{"id":"a6cce705.bca568","type":"inject","z":"89f87d49.41b81","name":"test DB local: DELETE '_system'","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_sqlDBlocal","vt":"str"},{"p":"payload.value","v":"DELETE FROM `messages` WHERE `device-id` = '_system'  LIMIT 10000","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":230,"y":2320,"wires":[["3332c2d3.f540ae"]]},{"id":"31575c49.1ac9c4","type":"inject","z":"89f87d49.41b81","name":"test DB local: DELETE 'tuya_bridge'","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_sqlDBlocal","vt":"str"},{"p":"payload.value","v":"DELETE FROM `messages` WHERE `device-name` = 'tuya_bridge'  LIMIT 100000","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":240,"y":2360,"wires":[["3332c2d3.f540ae"]]},{"id":"73a8d9a7.87b638","type":"inject","z":"89f87d49.41b81","name":"test DB local: DELETE '_connected'","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_sqlDBlocal","vt":"str"},{"p":"payload.value","v":"DELETE FROM `messages` WHERE `dps` = '_connected'  LIMIT 100000","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":240,"y":2400,"wires":[["3332c2d3.f540ae"]]},{"id":"55cf70e6.ee5ef","type":"comment","z":"89f87d49.41b81","name":"DB local  CLEANUP","info":"CUSTOMIZATIN\n\nGood candidate to be filtered...","x":170,"y":2280,"wires":[]},{"id":"531c417f.5b847","type":"inject","z":"89f87d49.41b81","name":"test DBlocal: AVG(voltage)  2021-04-27","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_sqlDBlocal","vt":"str"},{"p":"payload.value","v":"SELECT AVG(`value`) FROM `messages` WHERE `device-name` = 'AC meter' AND `dp-name` = 'voltage' AND `timestamp` BETWEEN '2021-04-27' AND '2021-04-28'","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":270,"y":2180,"wires":[["3332c2d3.f540ae"]]},{"id":"72f20175.c3719","type":"inject","z":"89f87d49.41b81","name":"test DBlocal: GET last result","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_sqlDBlocal","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":240,"y":2220,"wires":[["3332c2d3.f540ae"]]},{"id":"7c635dc0.0ca084","type":"comment","z":"89f87d49.41b81","name":"DB sql test","info":"CUSTOMIZATION\n\nused the 'AC meter'.voltage to get AVG\n\n","x":160,"y":2060,"wires":[]},{"id":"a542cc15.ac22a","type":"inject","z":"89f87d49.41b81","name":"test DB local: DELETE before 2021-02","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_sqlDBlocal","vt":"str"},{"p":"payload.value","v":"DELETE FROM `messages` WHERE `timestamp` <  '2021-02-01'","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":250,"y":2440,"wires":[["3332c2d3.f540ae"]]},{"id":"6b8f84dd.1102dc","type":"comment","z":"89f87d49.41b81","name":"Benchmark","info":"CUSTOMIZATION\n\n\nChoose the task (_zeroTash, _zeroLOG are ready):\n\n- add to chose task (in alldeviced)  the 'share':\n````\n         {\"action\":[{\n            \"device\":\"_system\",\n            \"property\":\"_benchmark_step\"}]}\n````\n- Use SET _system._benchkark to set your task (example: GET tuya_bridge.restart status )\n````\n   {\"device\":\"_system\",\n    \"property\":\"_benchmark\",\n    \"value\":{\"device\":\"tuya_bridge\",\n             \"property\":\"restart status\"}\n\n````\n\n- If you wanna run it to MAX free-run speed, change limits (2 in core, one in trigger) to a hight value (100000).\n\n- run benckmark: _system.doBenchmark.\n","x":610,"y":1740,"wires":[]},{"id":"be16aab6.ed77b8","type":"inject","z":"89f87d49.41b81","name":"Test doSCHEMA for 'power strip'","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_doSCHEMA","vt":"str"},{"p":"payload.value","v":"power strip","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":230,"y":1800,"wires":[["37cf409a.4d0b5"]]},{"id":"37cf409a.4d0b5","type":"link out","z":"89f87d49.41b81","name":"to core.fast_cmds","links":["8a1da02d.424ae"],"x":435,"y":1720,"wires":[]},{"id":"641cee4c.5eabf","type":"inject","z":"89f87d49.41b81","name":"Test tuyastatus power strip.SCHEMA","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_tuyastatus\",\"value\":{\"device\":\"power strip\"}}","payloadType":"json","x":240,"y":1760,"wires":[["37cf409a.4d0b5"]]},{"id":"b4d2d9e.ab5fb28","type":"link out","z":"89f87d49.41b81","name":"to core.std_cmd","links":["8a1da02d.424ae"],"x":455,"y":1520,"wires":[]},{"id":"10937fa1.5a037","type":"inject","z":"89f87d49.41b81","name":"doUPDATE   real only","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_doUPDATE","vt":"str"},{"p":"payload.value","v":"real","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":210,"y":1880,"wires":[["37cf409a.4d0b5"]]},{"id":"454c426.5bc6abc","type":"inject","z":"89f87d49.41b81","name":"Test SCHEMA for 'power strip'","props":[{"p":"payload.device","v":"power strip","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":220,"y":1720,"wires":[["37cf409a.4d0b5"]]},{"id":"1be9cc67.21b2d4","type":"comment","z":"89f87d49.41b81","name":"test SCHEMA","info":"","x":150,"y":1680,"wires":[]},{"id":"49a7f2bb.1591ec","type":"comment","z":"89f87d49.41b81","name":"test tuyastatus","info":"","x":150,"y":1480,"wires":[]},{"id":"95d45364.ef84f","type":"inject","z":"89f87d49.41b81","name":"test DB android: COUNT(*)","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_sqlDBandroid","vt":"str"},{"p":"payload.value","v":"SELECT COUNT(*) FROM messages","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":690,"y":2300,"wires":[["12227f5e.ddb0d1"]]},{"id":"12227f5e.ddb0d1","type":"link out","z":"89f87d49.41b81","name":"to core.std_cmd","links":["8a1da02d.424ae"],"x":895,"y":2300,"wires":[]},{"id":"ad716211.9c5f8","type":"inject","z":"89f87d49.41b81","name":"doUPDATE  virtual only","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_doUPDATE","vt":"str"},{"p":"payload.value","v":"virtual","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":220,"y":1920,"wires":[["37cf409a.4d0b5"]]},{"id":"f4766f0a.16c99","type":"inject","z":"89f87d49.41b81","name":"doUPDATE  fake only","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_doUPDATE","vt":"str"},{"p":"payload.value","v":"fake","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":220,"y":1960,"wires":[["37cf409a.4d0b5"]]},{"id":"b43f73db.dc91","type":"inject","z":"89f87d49.41b81","name":"doUPDATE   ALL","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_doUPDATE","vt":"str"},{"p":"payload.value","v":"NULL","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":200,"y":2000,"wires":[["37cf409a.4d0b5"]]},{"id":"5ab57760.0302b8","type":"inject","z":"89f87d49.41b81","name":"","props":[{"p":"paylad","v":"RIFF�.  WAVEfmt \u0010   \u0001 \u0001 D�  �X\u0001 \u0002 \u0010 data�.  \u0001 �\u000f\u0003 �/\u0003@�O\u0001T\u0001D�3\u0003$�\u0013\u0001\u0004 ���\u0001���\u0001���\u0001� ���\u0001���\u0001\b\u0001\u0018�'\u00048�G\u0003X�K < , \u001c \f � � � ���\u0003���\u0003���\u0002���\u0002\u0001�\u0010\u0004!�0\u0004A�P\u0003S�B\u00013\u0001#�\u0012\u0004\u0003��\u0003���\u0002���\u0002���\u0001� � � �\u0001\t�\u0018\u0002)�8\u0002I�X K\u0001;�* \u001b \u000b �\u0001���\u0002���\u0001�\u0001���\u0001� ���\u0002\u0002�\u0011 \" 2 B R R\u0001B�1\u0002\"�\u0011�\u0001\u0002���\u0002���\u0002���\u0004���\u0003���\u0001�   \u001a�)\u0001:�I\u0002Z�I\u0001:�)\u0002\u001a�\t\u0002���\u0003��� ���\u0001���\u0002���\u0001��\u0002\u0003\u0013�\"\u00033�B S\u0001Q A�0\u0004!�\u0010\u0005\u0001��\u0002� ���\u0002���\u0002� ���\u0002���\u0001\u000b \u001b�*\u0001; K Y�H\u00029�(\u0003\u0019�\b\u0001���\u0002���\u0004���\u0002���\u0001� ��� \u0004 \u0014\u0001$�3\u0001D�S\u0002P�?\u00010  �\u000f\u0001 ��\u0001� � � � � � � �\u0001���\u0002\f�\u001b\u0002,�;\u0002L�W\u0002H�7\u0003(�\u0017\u0002\b��\u0001���\u0001� ���\u0001� ���\u0003���\u0002\u0005 \u0015�$\u00015�D\u0001U�N\u0002?�.\u0003\u001f�\u000e\u0003���\u0003���\u0004��� �\u0001���\u0002���\u0001��\f\u0002\u001d�, =\u0001M�V\u0002G�6\u0002&�\u0015 \u0006 � � �\u0001���\u0002��� �\u0001���\u0002��\u0005\u0002\u0016�%�5\u0002F�U\u0004N�=\u0001. \u001e� \u0003���\u0004���\u0001�\u0001���\u0002��� � � � \u000e \u001e .\u0001>�M\u0002V�D\u00015\u0001%�\u0014\u0002\u0005��\u0001� �\u0001���\u0002���\u0002���\u0001���\u0002\u0007�\u0016\u0003'�6\u0002G�V\u0002M�<\u0001-�\u001c\u0002 ��\u0002��� � � ���\u0002���\u0002���\u0001� \u000f�\u001e\u0002/�?\u0001P�S\u0002D�3\u0004$�\u0013 \u0004\u0002���\u0003�����\u0002���\u0001� ���\u0001� \b \u0018�'\u00028�G\u0003X�K\u0001<�+\u0002\u001c�\u000b\u0004���\u0003���\u0001�\u0001���\u0002���\u0002���   \u0010 !\u00011�@�P\u0002S�B\u00033�\"\u0002\u0013�\u0002\u0004���\u0004���\u0001� ���\u0002���\u0002��� \t\u0002\u0019�(\u00029�H�X\u0004K�:\u0004+�\u001a\u0004\u000b��\u0001�\u0001���\u0002���\u0001� � �\u0001���\u0003\u0002�\u0011\u0001\"\u00012�A\u0004R�Q\u0005B�1\u0003\"�\u0011 \u0002\u0001���\u0002���\u0003���\u0003���\u0003���\u0003��\t\u0003\u001a�)\u0003:�I\u0003Z�I\u0003:�)\u0003\u001a�\t\u0001���\u0001���\u0002���\u0003���\u0003���\u0003��\u0002\u0002\u0013�\" 3\u0001C�R Q A 1 ! \u0011 \u0001��\u0002���\u0002���\u0003���\u0001�\u0001���\u0004�� \u0003\u001b�*�:\u0002K�X\u0001I 9 ) \u0019�\b\u0002���\u0001� ���\u0002���\u0003���\u0001� ��\u0003 \u0014\u0002$�3\u0005D�S\u0003P�?\u00010\u0001 �\u000f\u0004 ��\u0006���\u0003� ���\u0002�����\u0003���\u0003\f�\u001b\u0002,�; L\u0002X�G\u00038�'\u0003\u0018�\u0007\u0003���\u0003��� �\u0002���\u0003���\u0001���\u0001\u0005 \u0015�$\u00025�D\u0003U�N\u0003?�.\u0001\u001f \u000f��\u0003���\u0003��� �\u0001���\u0001��� � �\u0001 �\u001c\u0001-�<\u0002M�V\u0001G�6 '\u0001\u0017�\u0006\u0002���\u0002���\u0001� ���\u0001���\u0003���\u0003\u0006�\u0015\u0003&�5\u0003F�U\u0001N >�-\u0002\u001e� \u0001� ���\u0001���\u0001���\u0001��� � �\u0002�� \u0003\u001e�-\u0001>\u0002N�U\u0002F�5 &\u0001\u0016 \u0005��\u0002���\u0003���\u0004���\u0005��� �\u0002��\u0006\u0004\u0017�&\u00037�F\u0001W�L =\u0001-�\u001c\u0001 �� � � � � � � � � � � � \u000f \u001f / ? O U�D\u00024�#\u0002\u0014�\u0003\u0002���\u0004���\u0005���\u0001� ���\u0003���\u0001\b�\u0017\u0001(�7\u0001H�W L\u0001<�+ \u001c\u0001\f��\u0001���\u0001���\u0001���\u0001� ���\u0001��� \u0010\u0001 �/ @\u0001P�R C 3\u0001#�\u0012\u0003\u0003��\u0002���\u0003���\u0003���\u0001�\u0001���\u0001��\b\u0001\u0019�( 9 I\u0001Y�J\u0001;�*\u0001\u001b\u0001\u000b�� � ���\u0002��� � � ���\u0002�� \u0001\u0011 !�0\u0001B�Q\u0001R�A\u00012�!\u0001\u0012�\u0001\u0001� ���\u0001���\u0001� ���\u0001���\u0001��\t\u0001\u001a�)\u0001: J�Y\u0003J�9 *\u0001\u001a�\t �\u0002���\u0003��� �\u0002���\u0003���\u0002��\u0001 \u0013\u0001#�2\u0001C S�P\u0003A�0\u0003!�\u0010� \u0002���\u0002���\u0002���\u0003�����\u0002���\u0002\u000b\u0001\u001b�*\u0003;�J\u0001Y I�8\u0001)�\u0018\u0002\t�� �\u0002���\u0003��� �\u0002���\u0001� ��\u0003\u0001\u0014�#\u00024�C\u0003T�O\u0002@�/  \u0001\u0010��\u0003���\u0001� ���\u0003���\u0002���\u0001�\u0001��\u000b \u001c\u0001,�;\u0002L�W H\u00018�'\u0001\u0018 \b � � ���\u0001� � ���\u0001���\u0001� \u0005�\u0014\u0001% 5�D\u0001U O�>\u0003/�\u001e\u0004\u000f��\u0002��� �\u0001� ���\u0001���\u0001���\u0001��\f\u0001\u001d�,\u0001=�L\u0001W�F\u00017�&\u0001\u0017�\u0006\u0001���\u0001��� �\u0001���\u0001���\u0001���\u0003\u0006�\u0015\u0004&�5\u0002F�U N\u0001>�-\u0003\u001e� \u0003���\u0003���\u0003��� �\u0001��� �\u0002���\u0005\u000e�\u001d\u0005.�=\u0004N�U F\u00016�%\u0001\u0016�\u0005 �\u0001���\u0002���\u0002���\u0001���\u0002���\u0005\u0007�\u0016\u0002' 7�F\u0003W�L\u0003=�,\u0002\u001d�\f\u0001���\u0001���\u0002���\u0001���\u0001���\u0003���\u0004\u000f�\u001e\u0003/�>\u0002O�T E\u00015�$\u0002\u0015�\u0004\u0001���\u0002��� �\u0001���\u0002���\u0001���\u0002\b�\u0017 (\u00018�G X\u0001L�; ,\u0001\u001c�\u000b\u0001���\u0001���\u0003��� �\u0001���\u0001� ���\u0003\u0010�\u001f\u00010 @�O\u0001T�C\u00014 $�\u0012\u0001\u0003��\u0001���\u0001���\u0001� ���\u0001���\u0001��\b\u0001\u0019�(\u00039�H\u0004Y�J\u0001;\u0001+�\u001a\u0002\u000b��\u0002��� � � ���\u0003���\u0004���\u0003\u0001�\u0010� \u00021�@\u0001Q S�A\u00022�!\u0001\u0012�\u0001 �\u0002���\u0001��� �\u0001���\u0001��� �  \u0001\u001a�)\u0003:�I\u0003Z�I : * \u001a�\t\u0002���\u0002���\u0001� � � � � � � \u0002 \u0012�!\u00022�A\u0003S�P\u0003A�0\u0001!\u0001\u0011� \u0002���\u0002���\u0002��� �\u0001���\u0004���\u0002\u000b�\u001a +\u0001;�J\u0002Y�H\u00029�(\u0001\u0019�\b � � � �\u0002���\u0002��� �\u0001��� \u0003\u0001\u0013�\"\u00024�C T P�?\u00020�\u001f\u0002\u0010��\u0002���\u0002���\u0004���\u0002���\u0001� �\u0001��\u000b\u0003\u001c�+\u0003< L�W\u0003H�7\u0003(�\u0017 \b � � � � ���\u0003���\u0002���\u0002��\u0004\u0003\u0015�$\u00025�D\u0002U�N\u0003?�.\u0002\u001f�\u000e � �\u0001���\u0003���\u0003��� �\u0001���\u0001�\u0001 �\u001c\u0003-�<\u0002M�V\u0002G�6\u0003'�\u0016\u0004\u0007��\u0002���\u0002���\u0002���\u0002���\u0002���\u0001\u0006 \u0016 & 6�E\u0002V�M\u0002>�-\u0001\u001e \u000e � � � � � � � �\u0001���\u0002��� \u000e\u0001\u001e�-\u0002>�M V\u0001F�5 &\u0001\u0016�\u0005\u0003���\u0003���\u0003���\u0001���\u0001���\u0002��\u0006\u0003\u0017�&\u00037�F\u0002W�L\u0001= -�\u001c  \u0001���\u0001� ���\u0002��� �\u0002���\u0002��� \u000f�\u001e\u0002/�>\u0003O�T\u0001E 5 %\u0001\u0015�\u0004 �\u0001���\u0002� ���\u0003���\u0004���\u0003��\u0007\u0003\u0018�'\u00048�G\u0002X L�;\u0002,�\u001b�\u000b\u0003���\u0005���\u0006���\u0004���\u0002��� �\u0001 �\u000f\u0002  0�?\u0002P�S\u0001D\u00014�#\u0002\u0014�\u0003\u0001� � � �\u0001���\u0005���\u0006���\u0004��\b\u0003\u0019�(\u00019 I�X K\u0002;�*\u0006\u001b� \u0005��� �\u0001���\u0001��� �\u0001���\u0003�� \u0002\u0011 !�0\u0003A�P\u0002S C�2\u0001#�\u0012 \u0002\u0002���\u0005���\u0004��� � �\u0001���\u0001��\t \u001a\u0001*�9\u0001J�Y\u0003J�9\u0004*�\u0019  \u0001�����\u0003���\u0003���\u0003���\u0003���\u0001\u0002 \u0012 \" 2�A\u0002R�Q\u0004B�1\u0002! \u0011� \u0003���\u0001���\u0001���\u0001� ���\u0001� �� \u0001\u001b�*\u0001; K Y�H\u00019�(\u0002\u0019�\b\u0001� ���\u0002���\u0001� � � � ���\u0002\u0003�\u0012\u0002#�2\u0001C S Q @ 0   \u0010   �\u0001���\u0002���\u0002���\u0002���\u0001�\u0001��\u000b\u0004\u001c�+\u0003<�K\u0002X�G\u00028�'\u0001\u0018\u0001\b��\u0002��� � � �\u0001���\u0001���\u0002��\u0003\u0004\u0014�#\u00044�D\u0002U O�> /\u0001\u001f�\u000e\u0001��� �\u0001���\u0001���\u0001��� �\u0002���\u0003 �\u001c\u0002-�<\u0001M�V G\u00027�&\u0002\u0017 \u0007��\u0004���\u0002� � ���\u0003���\b���\u0006\u0005�\u0014\u0001&\u00016�E V\u0001N�=\u0003.�\u001d\u0001\u000e � � �\u0001���\u0001�\u0001���\u0002��� �\u0001��  \u001e\u0001.�= N\u0002V�E\u00046�%\u0002\u0016 \u0006��\u0002���\u0001� ���\u0002���\u0004���\u0003��\u0006�\u0016\u0002'�6\u0001G\u0001W�L\u0002=�,\u0002\u001d�\f\u0003���\u0002��� �\u0002���\u0003���\u0003���\u0003��\u000e\u0002\u001f /�>\u0003O�T\u0003E 5�$\u0003\u0015�\u0004\u0002���\u0001���\u0001���\u0001� � ���\u0001� \b \u0018�'\u00018�G\u0002X�K\u0003<�+\u0003\u001c�\u000b �\u0001� ���\u0001��� �\u0001��� � �\u0001 �\u000f   0 @ P\u0002T�C\u00034�#�\u0013\u0002\u0004��\u0001� ���\u0001���\u0002���\u0002� ���\u0001\t \u0019�(\u00039�H Y\u0002K�:\u0003+�\u001a\u0001\u000b��\u0001� ���\u0002���\u0004���\u0001� ���\u0003\u0001�\u0010\u0003!�0 A\u0001Q�R\u0002C�2\u0002#�\u0012\u0002\u0003��\u0001��� � � �\u0001���\u0002���\u0002��\t \u001a *�9\u0002J�Y\u0002J�9\u0002*�\u0019\u0002 ��\u0002���\u0002���\u0002���\u0002���\u0002��� \u0002\u0001\u0012�! 2 B\u0001R�Q\u0002B�1\u0002\"�\u0011\u0001\u0002��\u0002���\u0003���\u0002���\u0001��� �\u0001�� \u0002\u001b�*\u0001;�J\u0001Y�H\u00039�(\u0003\u0019�\b\u0002��� � �\u0001���\u0002���\u0001�\u0001���\u0004\u0003�\u0012\u0001# 3 C�R\u0003Q�@\u00041� \u0004\u0011��\u0004���\u0002�����\u0002���\u0002���\u0001� ��\u000b\u0002\u001c�+\u0002<�K\u0001X�G\u00028�' \u0018�\u0007\u0001���\u0002���\u0003���\u0002���\u0001���\u0003��\u0003\u0004\u0014�# 4\u0001D�S\u0003P�?\u0003/�\u001e\u0002\u000f ���\u0001���\u0001� ���\u0001���\u0001� ���\u0002 �\u001c -\u0002=�L\u0003W�F�6\u0002'�\u0016\u0001\u0007��\u0002���\u0002���\u0001���\u0002���\u0003���\u0003\u0005�\u0014\u0002%�4 E\u0001U�M\u0002>�-\u0003\u001e� \u0004���\u0002��� �\u0001���\u0001���\u0002���\u0001��  \u001e . > N V F 6 &�\u0015\u0002\u0006��\u0004���\u0003�����\u0002���\u0002���\u0002��\u0005\u0002\u0016�%\u00017 G W M�<\u0001- \u001d   ���\u0002���\u0001� � ���\u0003���\u0004���\u0003\u000f�\u001e /\u0001?�N\u0002U�D 5 %\u0001\u0015�\u0004\u0002��� �\u0001���\u0002��� � � � � \u0007 \u0018 ( 8 H�W\u0002L�;\u0002,�\u001b\u0003\f��\u0003���\u0003���\u0002��� �\u0001��� �\u0001 �\u000f\u0001 �/ @\u0001P�S\u0001D�3\u0001$�\u0013\u0001\u0004�� �\u0001���\u0001��� �\u0001���\u0003���\u0001\t \u0019�(\u00019�H\u0002Y�J\u0001;�*\u0001\u001b� \u0001���\u0001���\u0002���\u0003���\u0001� ���\u0002\u0001�\u0010\u0001! 1�@\u0002Q�R\u0002C�2\u0004#�\u0012\u0004\u0003��\u0001�\u0001���\u0002�����\u0002���\u0002���\u0001 �\u0019 *\u0001: J�Y\u0003J�9\u0002* \u001a�\t\u0004���\u0003���\u0001� � � � � � ��\u0001\u0002\u0012�!\u00042�A\u0002R�Q\u0001B 2 \"\u0001\u0012�\u0001��\u0002���\u0001�\u0001���\u0003���\u0002� ���\u0003\u000b�\u001a\u0002+ ;�J\u0002Y I�8\u0001)�\u0018 \t\u0001���\u0001���\u0001��� �\u0002���\u0003���\u0002\u0003 \u0013 #�2\u0001C�R\u0001Q A 1� \u0001\u0011� \u0002���\u0003���\u0003���\u0001���\u0001���\u0002��\u000b\u0001\u001c�+\u0001<�K\u0002X�G\u00038�' \u0018\u0001\b��\u0001���\u0001���\u0003���\u0001���\u0003���\u0003\u0004�\u0013 $\u00014�C\u0001T�O @\u00010�\u001f\u0004\u0010��\u0004���\u0002� ���\u0003���\u0004�����\u0003��\f\u0004\u001d�,�<\u0003M�V\u0004G�6�&\u0003\u0017�\u0006\u0003� ���\u0004���\u0003�����\u0002���\u0004��\u0004\u0003\u0015�$ 5\u0002E�T\u0003O�>\u0001/ \u001f� \u0002���\u0001� � ���\u0001� ���\u0002���\u0002� \u000e�\u001d\u0003.�=\u0003N�U\u0003F�5\u0002& \u0016�\u0005\u0002���\u0003���\u0002���\u0001� � � � � \u0006 \u0016 &�5\u0002F�U\u0002N�< - \u001d   �\u0001���\u0001��� � �\u0001���\u0001��� �\u0001\u000f�\u001e\u0001/�>\u0001O�T\u0002E�4\u0003%�\u0014\u0001\u0005 ���\u0002���\u0002���\u0001� ���\u0001���\u0001\u0007�\u0016\u0001'�6\u0002G�W\u0001L�; ,\u0001\u001c�\u000b\u0001���\u0001���\u0001���\u0003���\u0004���\u0004���\u0003\u0010�\u001f\u00010�?\u0001P�S\u0002D�3\u0003$�\u0013\u0003\u0004��\u0001���\u0001� � ���\u0001� � � ��\u0007\u0001\u0018 ) 9�H\u0002Y�J\u0003;�*\u0001\u001b \u000b��\u0001���\u0001���\u0001���\u0002��� �\u0002�� \u0004\u0011� \u00011 A�P\u0002S�B\u00033�\"\u0001\u0013 \u0003��\u0001� � ���\u0001���\u0002���\u0002���  \u0002\u001a�)\u0004:�I\u0003Z�I\u0001: * \u001a   ���\u0002���\u0002���\u0002���\u0002���\u0001�\u0001\u0002�\u0011\u0002\"�1\u0002B�Q\u0002R�A\u00022�!\u0002\u0012�\u0001\u0002���\u0002���\u0002���\u0002��� � � �\u0001\u000b�\u001a +\u0001;�J\u0003Y�H\u00049�(\u0002\u0019�\b��\u0002��� �\u0001���\u0002��� �\u0001���\u0002\u0003�\u0012 #\u00013�B\u0002S�P\u0001A�0 !\u0001\u0011� \u0001� ���\u0003���\u0002� ���\u0001���\u0001��\u000b\u0001\u001c�+\u0001< L�W\u0001H�7\u0001(�\u0017\u0002\b��\u0001� ���\u0003���\u0001� ���\u0002��� \u0004�\u0013\u0001$�3\u0001D T�O\u0001@ 0�\u001f\u0001\u0010   ���\u0001� � � � ���\u0002���\u0001�\u0001 �\u001c\u0002-�<�L\u0003W�F\u00027�& \u0017\u0001\u0007��\u0002���\u0002���\u0002���\u0001� ���\u0002��\u0004\u0001\u0015�$\u00015�D\u0002U�N\u0004?�.\u0002\u001f \u000f��\u0003���\u0001� � �\u0001��� � �\u0001� �� \u0001\u001e�-\u0001>�M\u0001V F�5\u0001&�\u0015\u0001\u0006�� �\u0002���\u0005���\u0004��� � �\u0001� \u0006�\u0015 &\u00016�E\u0002V�M\u0003>�-\u0003\u001e� \u0003���\u0002��� � �\u0001���\u0002�����\u0003��\u000e\u0002\u001f�. ? O\u0001U�D\u00015�$ \u0015 \u0005 �\u0001���\u0001���\u0002���\u0001���\u0002���\u0002\u0007�\u0016 ' 7 G W M = -\u0001\u001c�\u000b\u0002���\u0001�\u0001���\u0002���\u0002��� � �  \u0001\u0010�\u001f\u00010�?\u0003P�S\u0001D�3\u0001$ \u0014�\u0003\u0002���\u0003���\u0001���\u0001���\u0001� ���\u0001\b�\u0017\u0001( 8�G\u0002X�J\u0004;�*\u0005\u001b� \u0006���\u0006���\u0005���\u0004���\u0003��� � \u0001 \u0011� \u00021�@\u0001Q S�B\u00023�\"\u0001\u0013 \u0003 � ���\u0002��� � � � � � � \t\u0001\u0019�(�8\u0003J�Y\u0006J�9\u0003*�\u0019�\t\u0001���\u0002���\u0001� ���\u0002���\u0001� ��\u0001\u0003\u0012�!\u00052�A\u0002R R B�1\u0001\"�\u0011\u0001\u0002 � ���\u0002���\u0003���\u0002���\u0002���\u0004 �\u0019\u0001+ ;�J\u0002Y�H\u00019�(\u0002\u0019�\b\u0001� ���\u0004���\u0003���\u0001���\u0001���\u0001\u0003 \u0013�\"\u00013�B\u0001S�P\u0001A�0 !\u0001\u0011� \u0003���\u0002��� �\u0001���\u0003���\u0003���\u0002\f�\u001b\u0001,�;\u0001L�W H\u00018�'\u0001\u0018�\u0007\u0002���\u0002�����\u0003���\u0004���\u0001�\u0001��\u0003 \u0014\u0001$�3\u0002D T�O\u0003@�/\u0002  \u0010��\u0003���\u0003��� �\u0001���\u0004���\u0003���\u0003 �\u001c\u0001- = M W G 7�&\u0002\u0017�\u0006\u0002���\u0001� � � � ���\u0001� � � \u0005 \u0015�$\u00025�D\u0002U�N\u0002?�.\u0002\u001f�\u000e � � � � � � � � � � � � \u000e \u001e . > N\u0001V�E\u00036�%\u0006\u0016�\u0005\u0004���\u0001�\u0001���\u0003���\u0005���\u0004���\u0002\u0006�\u0015 & 6 F\u0001V�M\u0003>�-\u0004\u001e� \u0004���\u0005���\u0003�����\u0003���\u0002��� �\u0002\u000f�\u001e\u0003/�>\u0002O�T E\u00015�$\u0001\u0015�\u0004\u0002���\u0003��� � � �\u0001���\u0001��� \u0007 \u0017\u0001'�6\u0003G�V M\u0001=�,\u0002\u001d  ��\u0001��� �\u0001��� �\u0002���\u0004���\u0001 \u0001\u0010�\u001f\u00020�?\u0002P�S\u0004D�3\u0001$\u0001\u0014�\u0003\u0003�����\u0002���\u0001� ���\u0002���\u0003��\u0007\u0004\u0018�'\u00058�G\u0005X�K\u0001< ,�\u001b\u0002\u000b��\u0002��� ���\u0001� � � ��� �\u0002\u0001�\u0010\u0003!�0\u0001A Q�R\u0001C 3 # \u0013�\u0002\u0002���\u0005���\u0007���\u0003�����\u0002���\u0002\t�\u0018\u0001)\u00019�H\u0004Y�J\u0003;�)\u0001\u001a�\t\u0002���\u0003���\u0003���\u0003���\u0002���\u0001��\u0001\u0002\u0012�!\u00052�A\u0006R�Q\u0005B�1\u0003\"�\u0011�\u0001\u0002���\u0002��� � � � � � � �   \u001a *�9\u0002J�Y I 9 )\u0001\u0019�\b\u0001���\u0002��� � � � � � ���\u0001\u0003�\u0012\u0002#�2\u0001C S�P\u0004A�0\u0003!�\u0010\u0001\u0001��\u0002���\u0004���\u0002� ���\u0002���\u0001�� \u0002\u001b�*\u0002<�K\u0002X�G\u00028�' \u0018\u0001\b��\u0001���\u0003���\u0005���\u0004���\u0002��� \u0004\u0001\u0014�#\u00014�C\u0002T�O\u0002@ 0�\u001f\u0003\u0010��\u0003��� �\u0001���\u0002���\u0001� ���\u0002��\u000b\u0001\u001d�,\u0002=�L\u0004W�F\u00057�&\u0002\u0017 \u0007��\u0001��� �\u0001���\u0001���\u0001���\u0001��\u0004\u0001\u0015�$\u00015 E�T\u0001O�>\u0001/ \u001f�\u000e\u0002���\u0002���\u0001� � � � � � � � \u000e�\u001d\u0002.�= N V F�5\u0002&�\u0015\u0001\u0006 ���\u0002���\u0004���\u0003���\u0001� � � \u0006�\u0015\u0002&�5\u0003F�U N\u0002>�-\u0004\u001e� \u0005���\u0004���\u0001� ���\u0001���\u0001���\u0002��\u000e\u0003\u001f�.\u0001? O U E�4\u0002%�\u0014\u0002\u0005����\u0002���\u0002���\u0002���\u0002�����\u0002\u0007�\u0016\u0001' 7�F\u0001W�L =\u0001-�\u001c\u0002 �� �\u0001���\u0002��� �\u0001���\u0003���\u0002 �\u000f  \u00010�?\u0001P�S\u0001D�3\u0001$�\u0013\u0001\u0004��\u0001���\u0001���\u0001���\u0001���\u0002���\u0004\b�\u0017\u0005(�7\u0003H�W\u0002L�;\u0001,�\u001b\u0001\f\u0001���\u0002���\u0003���\u0002���\u0001� ���\u0001\u0001�\u0010\u0001!�0\u0001A�P S\u0001C�2 #\u0002\u0013�\u0002\u0002��� �\u0001� ��� �\u0001���\u0001��� \t\u0001\u0019�(\u00039�H\u0004Y�J\u0003;�*\u0002\u001b� \u0002���\u0002���\u0002��� � � � � � \u0002 \u0012�!\u00022�A\u0002R�Q\u0002B�1\u0003\"�\u0011\u0002\u0002��\u0001���\u0001���\u0003���\u0003���\u0004���\u0002 �\u0019\u0001*�9\u0003J�Y\u0004J�9\u0002*�\u0018 \t � � � � ���\u0002���\u0002���\u0003��\u0002\u0001\u0013 #�2\u0001C S Q�@\u00021� \u0001\u0011 \u0001��\u0002���\u0001� ���\u0002���\u0003���\u0003�� \u0003\u001b�*\u0002; K�X\u0003I�7\u0003(�\u0017\u0003\b��\u0001� ���\u0001� ���\u0002���\u0001� ��\u0003\u0001\u0014�#\u00014 D�S\u0001P�?\u00030�\u001f\u0003\u0010�� �\u0002���\u0001� � ���\u0002��� �\u0001��\u000b\u0002\u001c�+\u0002<�K W\u0001G�6\u0001' \u0017 \u0007\u0001���\u0001� � � �\u0001���\u0002���\u0001� \u0005\u0001\u0015�$\u00015�D\u0002U�N ?\u0002/�\u001e\u0003\u000f��\u0002���\u0004���\u0003���\u0002���\u0001��� �\u0002 �\u001c\u0002.�= N\u0002V�E\u00026 &�\u0015\u0002\u0006��\u0002� ���\u0001� ���\u0004���\u0002� ��\u0005\u0003\u0016�%\u00016�E\u0001V�M\u0001>�-\u0001\u001e� \u0001� ���\u0001���\u0001���\u0001� ���\u0003��� \u000f\u0002\u001f�. ?\u0002O�T\u0004E�4\u0002%�\u0014\u0001\u0005\u0001���\u0003���\u0004���\u0002��� � �\u0001��\u0006\u0001\u0017�&\u00037�F\u0001W�L =\u0001- \u001d�\f\u0001���\u0001� ���\u0002���\u0003���\u0001�\u0001���\u0003\u0010�\u001f\u00010 @ P�S\u0001D 4�#\u0002\u0014�\u0003\u0002� ���\u0002���\u0001� � � � � � \b \u0018\u0001(�7\u0002H�W\u0002L�;\u0002,�\u001b \f\u0001���\u0002��� � �\u0001���\u0001���\u0002�� \u0001\u0011�  1\u0001A�P\u0001S�B 3\u0002#�\u0012\u0002\u0003��\u0001� � ���\u0003���\u0003��� �\u0001��\b\u0001\u0019�(\u00019�H\u0001Y�J\u0001;�*\u0001\u001b \u000b��\u0003���\u0005���\u0005���\u0004��� �\u0001��\u0001\u0001\u0012 \"�1\u0001B R R B 2�!\u0001\u0012\u0001\u0002��\u0004���\u0005���\u0003���\u0001� � � �  �\u0019\u0002*�9\u0003J�Y J\u0002:�)\u0005\u001a�\t\u0004��� �\u0001���\u0001� ��� �\u0001���\u0002\u0003�\u0012\u0002#�2\u0001C S�P\u0001A�0\u0001! \u0011 \u0001��\u0002���\u0002���\u0001� � �\u0001���\u0002�� \u0001\u001b +\u0001;�J\u0002Y�H\u00019 ) \u0019�\b\u0002���\u0002���\u0003���\u0002���\u0002���\u0005��\u0003\u0004\u0014�#\u00014\u0001D�S\u0001P�?�/\u0002 �\u000f\u0002 ��\u0002���\u0004���\u0003���\u0001�\u0001���\u0002��\u000b\u0002\u001c�+\u0002<�K\u0003X�G\u00028�' \u0017\u0001\u0007�� �\u0001��� �\u0001��� �\u0001���\u0003��\u0004 \u0015\u0001%�4\u0003E�T\u0003O�>\u0002/�\u001e \u000f\u0001���\u0002���\u0001���\u0001���\u0004���\u0001���   \u001d\u0001-�< M W\u0001F�5 &\u0001\u0016�\u0005\u0003���\u0002� ���\u0003���\u0003���\u0003���\u0002\u0006�\u0015\u0001&�5 F\u0001V�M\u0003>�-\u0002\u001e�  �\u0001���\u0002���\u0002���\u0001� ���\u0003���\u0005\u000e�\u001d\u0003.�=�N\u0002U�D\u00045�$\u0003\u0015�\u0004\u0003���\u0002���\u0001���\u0002���\u0002���\u0002��\u0006\u0002\u0017�&\u00027�F\u0002W�L\u0002=�,\u0002\u001d�\f\u0002���\u0002���\u0002���\u0001� � � � � � \u000f\u0001 �/\u0002@�O\u0001T�C\u00014�#\u0003\u0014�\u0003\u0002��� � � � � � ���\u0003���\u0004\b�\u0017\u0001(\u00028�G\u0003X�K\u0003<�+\u0003\u001c�\u000b\u0003���\u0003��� �\u0001��� �\u0002���\u0005�� \u0005\u0011� \u00041�@\u0001Q S�B\u00013�\"\u0002\u0013�\u0002\u0001� ���\u0002���\u0001� � ���\u0002���\u0004\t�\u0018\u0005)�8\u0003I�X\u0001K ; +�\u001a\u0002\u000b��\u0002�����\u0002��� � � � �\u0001��\u0001 \u0012 \"\u00012�A\u0001R�Q\u0002B�1 \"\u0001\u0012�\u0001\u0004���\u0003��� ���\u0001���\u0002���\u0001�  �\u0019\u0001*�9\u0001J Z�I\u0001:�)\u0001\u001a�\t �\u0001��� �\u0001���\u0003���\u0002��� �\u0001\u0003�\u0012 # 3 C\u0001S�P\u0003A�0\u0003!�\u0010 \u0001\u0001���\u0002���\u0003���\u0002���\u0001���\u0003�� \u0002\u001b +�:\u0003K�X\u0002I 9�(\u0003\u0019�\b\u0002� ���\u0002��� � � � � � � \u0004 \u0014 $ 4 D T\u0001P�?\u00020�\u001f\u0001\u0010\u0001 ��\u0002��� � � � �\u0001���\u0001���\u0002\f�\u001b\u0002,�;\u0002L�W\u0002H�7\u0001(�\u0017\u0002\b��\u0004���\u0002� ���\u0003���\u0001���\u0001��\u0004\u0004\u0015�$\u00035�D\u0001U O ?�.\u0002\u001f�\u000e\u0002���\u0001� � ���\u0002���\u0001�\u0001���\u0006��\f\u0005\u001d�, =\u0002M�V\u0002G�6\u0001' \u0017 \u0006\u0001���\u0001� � � � � � �\u0001���\u0005\u0006�\u0015\u0006&�5\u0004F�U\u0002N�=\u0002.�\u001d\u0001\u000e��\u0002��� �\u0002���\u0003���\u0002� ���\u0001� \u000e�\u001d\u0003.�=\u0003N�U F 6\u0001%�\u0014\u0002\u0005��\u0004���\u0003��� � �\u0001���\u0002���\u0004\u0007�\u0016\u0002'�6 G W\u0001M�< -\u0001\u001d�\f\u0002��� � �\u0001���\u0001�\u0001���\u0004���\u0004��\u000e\u0004\u001f�.\u0003?�N�S\u0001D\u00014�#\u0003\u0014�\u0003\u0001� � ���\u0002���\u0002���\u0001� ���\u0002\b�\u0017\u0003(�7\u0002H�W\u0001L�;\u0003,�\u001b\u0003\f��\u0003���\u0003��� �\u0001��� � � �\u0001 �\u000f  �/\u0001A\u0001Q�R C 3�\"\u0002\u0013�\u0002��\u0002���\u0003���\u0002���\u0001���\u0001� � \t \u0019�(\u00029�H\u0001Y\u0001K�:\u0004+�\u001a\u0003\u000b����\u0002���\u0002���\u0002���\u0003���\u0004�� \u0003\u0011�!�1\u0003B�Q\u0003R�A�1\u0002\"�\u0011 \u0002\u0001���\u0001�\u0001���\u0002�����\u0002���\u0002��\t\u0001\u001a�)\u0002:�I Z\u0002J�9\u0004*�\u0019\u0002  ��� �\u0001���\u0001���\u0001���\u0001��� \u0003 \u0013\u0001#�2\u0003C�R\u0001Q\u0001A�0\u0002!�\u0010 \u0001 �\u0001��� �\u0001���\u0003���\u0003���\u0002� \u000b�\u001a\u0003+�:\u0005K�X\u0004I�8\u0002) \u0019�\b\u0003���\u0003���\u0003���\u0003���\u0002���\u0001��\u0003 \u0014 $\u00014�C\u0001T�O\u0003@�/\u0002  \u0010��\u0003���\u0003���\u0002��� �\u0001���\u0001���\u0003\f�\u001b\u0005,�;\u0004L�W\u0001H�7 ( \u0018\u0001\b�� � � � � ���\u0002���\u0001�\u0001��\u0004\u0002\u0015�$\u00015\u0001E�T O\u0001?�.\u0003\u001f�\u000e �\u0001���\u0001���\u0001���\u0001���\u0001���\u0001��\f\u0002\u001d�,\u0002=�L W\u0002G�6\u0001'�\u0016\u0001\u0007��\u0002���\u0003���\u0001���\u0001���\u0001���\u0001\u0006�\u0015\u0001&�5\u0001F�U\u0002N�=\u0003.�\u001d\u0002\u000e��\u0002���\u0002���\u0003���\u0003�����\u0003���\u0001\u000e \u001e\u0001.�=\u0003N�U\u0004F�5\u0003&�\u0015\u0002\u0006�� �\u0001��� � � �\u0001���\u0002���\u0002\u0007�\u0016\u0001'�6\u0003G�V\u0003M�<\u0003-�\u001c\u0003 �� �\u0001���\u0001� ���\u0003���\u0002� ��� \u000f\u0001\u001f�.\u0002? O�T\u0002E�4�$\u0003\u0014�\u0003\u0002���\u0002���\u0003���\u0004���\u0001� ���\u0003\b�\u0017\u0001(�7\u0002H�W\u0003L�;\u0005,�\u001b\u0002\f��\u0001� � �\u0001���\u0002���\u0002��� �   \u0010  \u00010�?�O\u0002T�C 3\u0002#�\u0012\u0004\u0003��\u0001� ���\u0004���\u0004���\u0003���\u0005��\b\u0005\u0019�( 9\u0002I�X\u0001K ;�*\u0002\u001b� \u0002���\u0002���\u0003���\u0003���\u0002��� �\u0002 �\u000f\u0003 �/\u0002@�P\u0001Q A�0\u0001!�\u0010\u0003\u0001��\u0003��� �\u0001���\u0001���\u0001���\u0002��\b\u0003\u0019�(\u00039�H\u0001Y�H\u00019�(\u0003\u0019�\b\u0002�����\u0003���\u0002�����\u0003���\u0002�� \u0002\u0011� \u00012�A R\u0001P�?\u00010   \u0010  ��\u0002���\u0002�����\u0002���\u0001�\u0001���\u0002 �\u0019\u0002*�9\u0002J�W H 8 ( \u0018 \b � � � � �\u0001���\u0003���\u0004���\u0002\u0002�\u0012 #\u00013�B\u0001S O ? / \u001f�\u000e\u0001 \u0001���\u0003���\u0003���\u0002���\u0003���\u0003�� \u0001\u001b�*\u0001;�J\u0001W�F\u00017�&\u0001\u0017�\u0006\u0001���\u0001���\u0003���\u0001��� �\u0001���\u0001\u0004�\u0013\u0001$�3\u0001D�S\u0002N >�- \u001e \u000e   �\u0002���\u0004���\u0004���\u0002��� �\u0001��\u000b \u001c ,\u0001<�K\u0001V�E 6 & \u0016\u0001\u0006��\u0003���\u0003��� � �\u0001���\u0003���\u0004\u0005�\u0014\u0005%�4\u0001E\u0001U�L\u0003=�,\u0002\u001d�\f\u0001��� �\u0001���\u0003���\u0003���\u0003���\u0003��\f\u0003\u001d�,\u0004=�L\u0002U E�4\u0003%�\u0014\u0001\u0005�� �\u0001���\u0001�����\u0003���\u0002����\u0005\u0003\u0016�%\u00036�E\u0001V\u0001L�;\u0003,�\u001b\u0002\f��\u0002���\u0002���\u0002���\u0001� ���\u0002���\u0001\u000e�\u001d\u0002.�=\u0001N�S D\u00024�#\u0003\u0014�\u0003\u0004��� �\u0001��� �\u0001� ���\u0004���\u0006\u0007�\u0016\u0001'\u00017�F\u0004W�J\u0004;�*\u0005\u001b� \u0003�����\u0001���\u0002���\u0003���\u0002���\u0001 �\u000e\u0001\u001f�. ?\u0001O S�B\u00033�\"\u0003\u0013�\u0002\u0001���\u0002� ���\u0001���\u0001���\u0002���\u0003\b�\u0017\u0001( 8�G\u0002X�I\u0003:�)\u0003\u001a�\t\u0003���\u0002���\u0001���\u0003���\u0004���\u0002���\u0002\u0010�\u001f\u00010\u0001@�O\u0002R�A 2\u0001!�\u0010\u0002\u0001��\u0001���\u0001��� �\u0001��� �\u0001���\u0003\t�\u0018\u0003)�8\u0001I\u0001Y�H\u00019 )�\u0018\u0003\t��\u0002� ���\u0003���\u0002���\u0001���\u0003�� \u0002\u0011 !�0\u0004A�P\u0004Q�?\u00010   \u0010��\u0004���\u0006���\u0005���\u0002� ���\u0001� ��\t\u0003\u001a�)\u0001:�I\u0001X�G\u00018�'\u0001\u0018�\u0007\u0002��� �\u0002���\u0004��� �\u0002���\u0003��\u0001 \u0012\u0001\"�1\u0001B�R\u0001O�>\u0003/�\u001e\u0003\u000f��\u0002� ���\u0001� ���\u0003��� �\u0002���\u0002\u000b \u001b�*\u0002; K�V\u0003G�6\u0001'�\u0016\u0001\u0007��\u0001� ���\u0001� ���\u0001� ���\u0002��\u0002\u0003\u0013�#\u00014�C\u0002T�M\u0004>�-\u0002\u001e \u000e��\u0003���\u0004���\u0002� ���\u0002���\u0002���\u0001\f�\u001b\u0002,�;\u0002L�U F 6 & \u0016 \u0006 � � ���\u0002���\u0002��� �\u0002����\u0004\u0001\u0015�$\u00015 E U�L\u0003=�, \u001d\u0001 �� �\u0002���\u0003���\u0003���\u0003���\u0001� �  �\u001c\u0001-�<\u0001M U�D\u00015�$\u0001\u0015�\u0004\u0001���\u0001���\u0001��� �\u0001���\u0001���\u0002\u0006�\u0015\u0001&�5\u0001F�U\u0001L�;\u0001, \u001c�\u000b\u0002���\u0003��� �\u0002���\u0003��� �\u0001���\u0003\u000e�\u001d\u0001. >�M\u0003T�C\u00014 $�\u0013\u0002\u0004�� �\u0002���\u0003��� �\u0001���\u0001� ��\u0006\u0003\u0017�&\u00037�F W\u0001K�:\u0001+ \u001b� \u0003���\u0003���\u0001���\u0002���\u0003���\u0001�  �\u000e\u0001\u001f�.\u0002?�N\u0001S C�2\u0002#�\u0012\u0001\u0003\u0001���\u0002��� �\u0001��� �\u0001���\u0001��\u0007\u0001\u0018�'\u00048�G\u0007X�I\u0006:�)\u0002\u001a�\t �\u0001���\u0003���\u0002��� �\u0001���\u0001���\u0001\u0010�\u001f\u00010�?\u0001P R�A\u00012�! \u0012\u0002\u0002��\u0003���\u0002���\u0001��� �\u0001���\u0001��\b \u0019\u0002)�8\u0002I�X I\u00029�(\u0003\u0019�\b\u0002���\u0001���\u0002���\u0003��� �\u0002���\u0004\u0001�\u0010\u0004!�0\u0003A�P\u0001Q A 1 ! \u0011  ��\u0001� � � � ���\u0002���\u0001� ��\t\u0002\u001a�)\u0001: J�W\u0002H�7\u0001( \u0018�\u0007\u0001� ���\u0002���\u0004���\u0003���\u0001�\u0001��\u0001\u0001\u0012 \"�1\u0003B�Q\u0005P�?\u00030�\u001e�\u000e\u0002 ��\u0001� ���\u0001� ���\u0002���\u0002� �� \u0002\u001b�*\u0003;�J\u0002W�F\u00047�&\u0005\u0017�\u0006\u0002� ���\u0001���\u0002��� � � � � \u0003 \u0013 # 3 C\u0001S�M\u0003>�-\u0003\u001e�   \u0001���\u0002���\u0002���\u0002��� �\u0001��� \f\u0002\u001c�+\u0005<�K\u0005V�E\u00026�%\u0001\u0016�\u0005\u0001���\u0003���\u0002���\u0002���\u0001� ��� \u0004\u0001\u0014�#\u00014�D U\u0001M =�,\u0003\u001d�\f\u0003��� �\u0001���\u0002���\u0001���\u0002���\u0002��\f\u0001\u001d - = M U E�4\u0002%�\u0014\u0004\u0005��\u0003��� �\u0002���\u0004���\u0002���\u0001��\u0004\u0001\u0016�% 6\u0001F�U L <\u0001,�\u001b\u0002\f��\u0004���\u0003��� �\u0001���\u0001� ���\u0001 �  \u001e\u0002.�=\u0003N�S\u0002D�3\u0001$�\u0013\u0001\u0004��\u0001���\u0002���\u0001� ���\u0002���\u0002��\u0006\u0002\u0017�&\u00017\u0001G�V\u0002K�: + \u001b\u0001\u000b��\u0002��� �\u0001��� � � �\u0001���\u0002 �\u000e\u0002\u001f�.\u0002?�N\u0004S�B\u00023�\"\u0001\u0013 \u0003 �\u0001���\u0002���\u0002���\u0001���\u0001���\u0003\u0007�\u0014\u0003#�0\u0001>\u0001K�>\u00021�\"�\u0015\u0002\b��\u0004���\u0002�����\u0002��� �\u0001���\u0002 �\u000b \u0017\u0001\"�,�6\u00038�,\u0004!�\u0016\u0001\f \u0001 � � � � � �\u0001���\u0001���\u0001� \u0005� \u0001\u0016�\u001d\u0001& .�$\u0002\u001d�\u0013\u0005\f�\u0003\u0005���\u0003���\u0001� � � ���\u0002���\u0003 �\u0005\u0002\f \u0012�\u0016\u0002\u001d�\u001b\u0001\u0016 \u0010� \u0002\u0005��\u0002���\u0002���\u0002���\u0002���\u0002���\u0004��\u0001\u0004\u0005�\u0007\u0003\u000b� \u0001\u0010\u0001\f�\b\u0003\u0006�\u0002\u0002\u0001��\u0003���\u0003��� �\u0002���\u0002���  \u0002 ��\u0002\u0001�  \u0001\u0001\u0001�   ","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":"","topic":"","x":1350,"y":3880,"wires":[["83a6a741.b083d8"]]},{"id":"83a6a741.b083d8","type":"play audio","z":"89f87d49.41b81","name":"","voice":"","x":1550,"y":3860,"wires":[]},{"id":"92a1f6ed.d388f8","type":"play audio","z":"89f87d49.41b81","name":"","voice":"14","x":750,"y":860,"wires":[]},{"id":"7e672c85.ba1aa4","type":"base64","z":"89f87d49.41b81","name":"","action":"","property":"payload","x":740,"y":800,"wires":[["92a1f6ed.d388f8"]]},{"id":"c64a50dd.083f1","type":"inject","z":"89f87d49.41b81","name":"test  BEEP","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_beep","vt":"str"},{"p":"payload.value","v":"any","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"str","x":700,"y":2400,"wires":[["f302b04b.6478b"]]},{"id":"dd28534e.b1b93","type":"inject","z":"89f87d49.41b81","name":"test  Hello Word","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_play","vt":"str"},{"p":"payload.value","v":"\"Ciao mondo\"","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":720,"y":2440,"wires":[["f302b04b.6478b"]]},{"id":"f302b04b.6478b","type":"link out","z":"89f87d49.41b81","name":"to core.std_cmd","links":["8a1da02d.424ae"],"x":895,"y":2400,"wires":[]},{"id":"dea078d9.039b68","type":"inject","z":"89f87d49.41b81","name":"test  BEEP LOOP","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_beep_loop","vt":"str"},{"p":"payload.value","v":"{\"count\":3, \"timeout\":1000}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":720,"y":2480,"wires":[["f302b04b.6478b"]]},{"id":"52445b44.003e34","type":"exec","z":"89f87d49.41b81","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":210,"y":840,"wires":[["32a4c277.338ace"],["32a4c277.338ace"],[]]},{"id":"32a4c277.338ace","type":"subflow:81d3b584.14c888","z":"89f87d49.41b81","name":"","env":[{"name":"deviceID","value":"_system","type":"str"},{"name":"propertyDP","value":"_exec","type":"str"},{"name":"value","value":"@msg.payload","type":"str"}],"x":390,"y":840,"wires":[["aa6116ba.7b69c8"]]},{"id":"a6e70593.b4a8f8","type":"inject","z":"89f87d49.41b81","name":"test  EXEC: dir","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_exec","vt":"str"},{"p":"payload.value","v":"DIR  /B  /ON  *.json","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":190,"y":2500,"wires":[["7ab2060b.16fd58"]]},{"id":"7ab2060b.16fd58","type":"link out","z":"89f87d49.41b81","name":"to core.std_cmd","links":["8a1da02d.424ae"],"x":355,"y":2500,"wires":[]},{"id":"6586860d.481bb8","type":"function","z":"89f87d49.41b81","name":"remote log","func":"// only if device is present in alldevices !!\n//-------------------------------- local functions:\nfunction _callJSONMethod(obj, fname, a, b, c, d) {\n   // see: https://stackoverflow.com/questions/49125059/how-to-pass-parameters-to-an-eval-based-function-injavascript\n   var wrap = s => \"{ return \" + obj[fname] + \" };\" //return the block having function expression\n   var func = new Function(wrap(obj[fname])); // ignore the node-red ⚠ warning\n   return func.call(null).call(obj, a, b, c, d); //invoke the function using arguments\n}\n\n\n\nvar newMsg = { \n    \"payload\":{\n        \"deviceId\": null, \n        \"data\": {\n            \"t\": Math.floor( Date.now() / 1000 ),    // timestamp (sec), optional, \n            \"dps\":{\n            }}}};\n\n\n// ------  main\n    let paydata = JSON.parse(msg.payload);\n    \n//---------------------- some assert\n    if (!( paydata.remote_from )) {\n        node.warn([\"ASSERT [proxy] fail: msg.payload.remote_from  must exist\", msg]);\n        return [null];\n        }\n    \n    var alld = global.get(\"alldevices\");\n    const PSEUDODP = alld.__pseudodp;\n    var o = _callJSONMethod(alld, \"__getODev\", paydata.device || \"_system\");\n    \n    if (o === undefined){\n        node.warn([\"ERROR [proxy]: not found remote device \"+ paydata.device, msg]);\n        return [null];\n     }\n     //    newMsg.from = o.id;\n    newMsg.payload.deviceId =o.id;\n    newMsg.payload[\"remote_from\"] =  paydata.remote_from;\n\n        \n    if (paydata.list !== undefined){  // is list\n        newMsg.payload.data.dps[\"list\"]= paydata.list.sort();\n        return newMsg;\n    }\n    \n    if (paydata.schema !== undefined){     // is schema: record for any dp - pseudoDP\n       Object.entries(paydata.schema).forEach(([key, value]) =>{\n          if ( ! PSEUDODP.includes(key.toUpperCase())) {\n              newMsg.payload.data.dps[key]=  value;\n              }\n          });\n    return newMsg;\n    }\n//    node.warn([\"IN REST \", paydata])\n    if(paydata.status)  // is SET\n        return null;\n//       newMsg.payload.data.dps[ paydata.property]=  paydata.status;   // extra value 'sent'\n//    else                // is GET\n      newMsg.payload.data.dps[ paydata.property]=  paydata.value; \n //   node.warn([\" OUT msg remote \", newMsg]);\n    return newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1010,"y":140,"wires":[["cd81b742.e8a268"]]},{"id":"3947d6a4.4bc86a","type":"inject","z":"89f87d49.41b81","name":"*test toShare \"_system SET doTrigger 5000\"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_toShare\",\"value\":{\"share\":[{\"action\":[{\"device\":\"_system\",\"property\":\"_doTrigger\",\"value\":5000}]}]}}","payloadType":"json","x":710,"y":1500,"wires":[["6473326d.c244ac"]],"info":"FOR test - Required automations in Tuya :\n5000: set  switch module #1 ON:\n\n`if \"tuya_bridge\"countdown:5000, \"tuya_bridge\"countdown:0 + 'switch module #1'switch:on`\n\n"},{"id":"6473326d.c244ac","type":"link out","z":"89f87d49.41b81","name":"to core.fast_cmds","links":["c084a743.290b28"],"x":955,"y":1500,"wires":[]},{"id":"8ce9000a.a5fc3","type":"inject","z":"89f87d49.41b81","name":"*test toShare \"_system GET doTrigger\"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_toShare\",\"value\":{\"share\":[{\"action\":[{\"device\":\"_system\",\"property\":\"_doTrigger\",\"value\":null}]}]}}","payloadType":"json","x":690,"y":1580,"wires":[["6473326d.c244ac"]],"info":"FOR test - Required automations in Tuya :\n5000: set  switch module #1 ON:\n\n`if \"tuya_bridge\"countdown:5000, \"tuya_bridge\"countdown:0 + 'switch module #1'switch:on`\n\n"},{"id":"35280f14.ce8c1","type":"inject","z":"89f87d49.41b81","name":"*test toShare \"_system SET doTrigger 5020\"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_toShare\",\"value\":{\"share\":[{\"action\":[{\"device\":\"_system\",\"property\":\"_doTrigger\",\"value\":5020}]}]}}","payloadType":"json","x":710,"y":1540,"wires":[["6473326d.c244ac"]],"info":"FOR test - Required automations in Tuya :\n5000: set  switch module #1 ON:\n\n`if \"tuya_bridge\"countdown:5000, \"tuya_bridge\"countdown:0 + 'switch module #1'switch:on`\n\n"},{"id":"477c45d8.ce4dfc","type":"inject","z":"89f87d49.41b81","name":"*test toShare +info \"_system SET doTrigger 5000\"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"device\":\"_system\",\"property\":\"_toShare\",\"value\":{\"info\":{\"property\":\"_doTrigger\",\"value\":5000},\"share\":[{\"action\":[{\"device\":\"_system\"}]}]}}","payloadType":"json","x":730,"y":1620,"wires":[["6473326d.c244ac"]],"info":"FOR test - Required automations in Tuya :\n5000: set  switch module #1 ON:\n\n`if \"tuya_bridge\"countdown:5000, \"tuya_bridge\"countdown:0 + 'switch module #1'switch:on`\n\n"},{"id":"2ed08207.23ffae","type":"link out","z":"89f87d49.41b81","name":"to core.fast_cmds","links":["c084a743.290b28"],"x":1235,"y":840,"wires":[]},{"id":"284250cf.ebbeb","type":"function","z":"89f87d49.41b81","name":"command/share select","func":"if (msg.share)           // is share\n   return([null, msg]);\nnewMsg = {payload:msg};  // is command\nreturn ([newMsg, null]);","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1040,"y":860,"wires":[["2ed08207.23ffae"],["818feefe.ab666"]],"outputLabels":["to core.fst_cmds","to core.share_IN"]},{"id":"e7da678.417d298","type":"inject","z":"89f87d49.41b81","name":"doUPDATE   REMOTE","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_doUPDATE","vt":"str"},{"p":"payload.value","v":"NULL","vt":"str"},{"p":"payload.remote","v":"ANDROID","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":380,"y":2040,"wires":[["37cf409a.4d0b5"]]},{"id":"337b6aaa.988036","type":"inject","z":"89f87d49.41b81","name":"Test doSCHEMA for 'power strip'","props":[{"p":"payload.device","v":"_system","vt":"str"},{"p":"payload.property","v":"_doSCHEMA","vt":"str"},{"p":"payload.value","v":"power strip","vt":"str"},{"p":"payload.remote","v":"ANDROID","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":310,"y":1840,"wires":[["37cf409a.4d0b5"]]}]